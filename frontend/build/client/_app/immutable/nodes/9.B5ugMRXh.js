import"../chunks/CWj6FrbW.js";import{s as c,o as Aa}from"../chunks/BnHnlVXU.js";import{c as V,f as m,a as o,b4 as Fa,p as ha,k as U,R as Jt,S as qa,s as i,i as e,b as ba,h as a,g as r,r as t,t as R,d as l,U as $e,n as z,l as Ye,T as Oa,$ as za,j as _t}from"../chunks/BbuzmxRY.js";import{i as v}from"../chunks/XgF_cVEg.js";import{I as ze,s as Ue,r as xa,c as Ua,e as wa,f as Ja,b as $a,i as ka,a as Mt}from"../chunks/Bm_MFDQ1.js";import{h as Da}from"../chunks/BwaF3Q6U.js";import{l as Je,s as De,a as Ba,b as Ha}from"../chunks/cVoOpi3M.js";import{p as Va}from"../chunks/C4oicLII.js";import{g as Ia}from"../chunks/Cak3-npf.js";import{p as we}from"../chunks/BVZH3wAp.js";import{b as Qa}from"../chunks/BjJ5yzjH.js";import"../chunks/COK2pY8o.js";import{U as da}from"../chunks/Cl_eLyHP.js";import{L as ut}from"../chunks/Cr7rThFx.js";import{T as Ka}from"../chunks/WFeWt-3y.js";import{A as Wa}from"../chunks/3e7qVaIY.js";import{P as Xa,R as Ya}from"../chunks/CfIP2vrm.js";import{T as Za}from"../chunks/-YWqKXAd.js";import{T as ma,R as er}from"../chunks/BB-mXNPS.js";import{C as ya}from"../chunks/DKpI9zPo.js";import{C as tr}from"../chunks/C4YxXooL.js";import{F as ar}from"../chunks/BXnacA_s.js";import{G as ia}from"../chunks/BFn81jTo.js";import{C as rr}from"../chunks/B5_3TA3C.js";import{C as sr}from"../chunks/Dp_7Pi6Y.js";function or(L,_){const N=Je(_,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];ze(L,De({name:"arrow-down"},()=>N,{get iconNode(){return b},children:(T,x)=>{var u=V(),k=m(u);Ue(k,_,"default",{}),o(T,u)},$$slots:{default:!0}}))}function nr(L,_){const N=Je(_,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"7 10 12 15 17 10"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3"}]];ze(L,De({name:"download"},()=>N,{get iconNode(){return b},children:(T,x)=>{var u=V(),k=m(u);Ue(k,_,"default",{}),o(T,u)},$$slots:{default:!0}}))}function Ut(L,_){const N=Je(_,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=[["path",{d:"M15 3h6v6"}],["path",{d:"M10 14 21 3"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}]];ze(L,De({name:"external-link"},()=>N,{get iconNode(){return b},children:(T,x)=>{var u=V(),k=m(u);Ue(k,_,"default",{}),o(T,u)},$$slots:{default:!0}}))}function la(L,_){const N=Je(_,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=[["circle",{cx:"18",cy:"18",r:"3"}],["circle",{cx:"6",cy:"6",r:"3"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9"}]];ze(L,De({name:"git-merge"},()=>N,{get iconNode(){return b},children:(T,x)=>{var u=V(),k=m(u);Ue(k,_,"default",{}),o(T,u)},$$slots:{default:!0}}))}function ir(L,_){const N=Je(_,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=[["circle",{cx:"11",cy:"11",r:"8"}],["path",{d:"m21 21-4.3-4.3"}]];ze(L,De({name:"search"},()=>N,{get iconNode(){return b},children:(T,x)=>{var u=V(),k=m(u);Ue(k,_,"default",{}),o(T,u)},$$slots:{default:!0}}))}function lr(L,_){const N=Je(_,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5"}],["path",{d:"m9 11 3 3L22 4"}]];ze(L,De({name:"square-check-big"},()=>N,{get iconNode(){return b},children:(T,x)=>{var u=V(),k=m(u);Ue(k,_,"default",{}),o(T,u)},$$slots:{default:!0}}))}function dr(L,_){const N=Je(_,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}]];ze(L,De({name:"square"},()=>N,{get iconNode(){return b},children:(T,x)=>{var u=V(),k=m(u);Ue(k,_,"default",{}),o(T,u)},$$slots:{default:!0}}))}function cr(L,_){const N=Je(_,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];ze(L,De({name:"x"},()=>N,{get iconNode(){return b},children:(T,x)=>{var u=V(),k=m(u);Ue(k,_,"default",{}),o(T,u)},$$slots:{default:!0}}))}var vr=l("<!> Deselect All",1),pr=l("<!> Select All",1),_r=l('<div class="flex items-center justify-center py-12"><!> <span class="ml-2 text-sm text-gray-500">Loading rules from Elastic...</span></div>'),ur=l('<div class="flex items-center gap-3 py-8 justify-center"><!> <span class="text-sm text-red-600"> </span></div>'),gr=l('<div class="text-center py-8 text-sm text-gray-500"><!></div>'),fr=l('<span class="w-2 h-2 rounded-full bg-green-500 flex-shrink-0" title="Enabled"></span>'),xr=l('<span class="w-2 h-2 rounded-full bg-gray-300 flex-shrink-0" title="Disabled"></span>'),mr=l('<label class="flex items-center gap-3 py-2.5 px-3 hover:bg-gray-50 rounded-lg cursor-pointer transition-colors border-b border-gray-50 last:border-0"><input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-yellow-600 focus:ring-yellow-500"/> <div class="flex-1 min-w-0"><div class="font-medium text-sm text-gray-900 truncate"> </div> <div class="text-xs text-gray-400 truncate"> </div></div> <span> </span> <span class="text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded flex-shrink-0"> </span> <!></label>'),yr=l('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"><div class="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[85vh] overflow-hidden flex flex-col"><div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between flex-shrink-0"><div><h2 class="text-xl font-semibold text-gray-900">Select Rules to Export</h2> <p class="text-sm text-gray-500 mt-1">Export to branch: <code class="text-xs bg-gray-100 px-1.5 py-0.5 rounded"> </code></p></div> <button class="text-gray-400 hover:text-gray-600 transition-colors"><!></button></div> <div class="px-6 py-3 border-b border-gray-100 flex items-center gap-3 flex-shrink-0 flex-wrap"><div class="relative flex-1 min-w-[200px]"><!> <input type="text" placeholder="Search rules..." class="w-full pl-9 pr-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent"/></div> <select class="text-sm border border-gray-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500"><option>All Severities</option><option>Critical</option><option>High</option><option>Medium</option><option>Low</option></select> <button class="inline-flex items-center gap-1.5 text-sm text-gray-600 hover:text-gray-900 px-3 py-2 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors"><!></button></div> <div class="flex-1 overflow-y-auto px-6 py-2 min-h-0"><!></div> <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between flex-shrink-0 bg-gray-50"><span class="text-sm text-gray-500"> </span> <div class="flex items-center gap-3"><button class="px-4 py-2 text-sm text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors">Cancel</button> <button class="px-4 py-2 text-sm text-yellow-700 border border-yellow-300 rounded-lg hover:bg-yellow-50 transition-colors font-medium"> </button> <button class="inline-flex items-center gap-2 px-4 py-2 text-sm bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed"><!> </button></div></div></div></div>');function hr(L,_){ha(_,!0);let N=U(Jt([])),b=U(Jt(new Set)),T=U(!1),x=U(""),u=U(""),k=U("all"),le=$e(()=>e(N).filter(j=>{const G=!e(u)||j.name.toLowerCase().includes(e(u).toLowerCase())||j.rule_id.toLowerCase().includes(e(u).toLowerCase()),ke=e(k)==="all"||j.severity===e(k);return G&&ke})),J=$e(()=>e(b).size),de=$e(()=>e(le).length>0&&e(le).every(j=>e(b).has(j.rule_id)));qa(()=>{_.open&&Pe()});async function Pe(){i(T,!0),i(x,""),i(u,""),i(k,"all");try{const G=await(await fetch(`${we.baseUrl}/api/rules/list`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:_.projectId,space:_.space})})).json();G.success?(i(N,G.rules,!0),i(b,new Set(e(N).map(ke=>ke.rule_id)),!0)):i(x,G.message||"Failed to load rules",!0)}catch(j){i(x,j.message,!0)}finally{i(T,!1)}}function Ze(j){const G=new Set(e(b));G.has(j)?G.delete(j):G.add(j),i(b,G,!0)}function et(){if(e(de)){const j=new Set(e(b));for(const G of e(le))j.delete(G.rule_id);i(b,j,!0)}else{const j=new Set(e(b));for(const G of e(le))j.add(G.rule_id);i(b,j,!0)}}function tt(){_.onexport(Array.from(e(b)))}function gt(){_.onexport(null)}function Tt(j){switch(j){case"critical":return"bg-red-100 text-red-700";case"high":return"bg-orange-100 text-orange-700";case"medium":return"bg-yellow-100 text-yellow-700";case"low":return"bg-blue-100 text-blue-700";default:return"bg-gray-100 text-gray-600"}}var K=V(),$=m(K);{var q=j=>{var G=yr();G.__keydown=d=>d.key==="Escape"&&_.onclose();var ke=a(G);ke.__click=d=>d.stopPropagation();var ft=a(ke),Me=a(ft),at=r(a(Me),2),xt=r(a(at)),Dt=a(xt,!0);t(xt),t(at),t(Me);var mt=r(Me,2);mt.__click=function(...d){var g;(g=_.onclose)==null||g.apply(this,d)};var Bt=a(mt);cr(Bt,{class:"w-5 h-5"}),t(mt),t(ft);var yt=r(ft,2),ht=a(yt),Gt=a(ht);ir(Gt,{class:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"});var Lt=r(Gt,2);xa(Lt),t(ht);var Be=r(ht,2),rt=a(Be);rt.value=rt.__value="all";var He=r(rt);He.value=He.__value="critical";var Ve=r(He);Ve.value=Ve.__value="high";var Ie=r(Ve);Ie.value=Ie.__value="medium";var st=r(Ie);st.value=st.__value="low",t(Be);var bt=r(Be,2);bt.__click=et;var Ht=a(bt);{var Vt=d=>{var g=vr(),A=m(g);lr(A,{class:"w-4 h-4"}),z(),o(d,g)},It=d=>{var g=pr(),A=m(g);dr(A,{class:"w-4 h-4"}),z(),o(d,g)};v(Ht,d=>{e(de)?d(Vt):d(It,!1)})}t(bt),t(yt);var wt=r(yt,2),Qt=a(wt);{var At=d=>{var g=_r(),A=a(g);ut(A,{class:"w-6 h-6 animate-spin text-yellow-600"}),z(2),t(g),o(d,g)},Kt=d=>{var g=V(),A=m(g);{var ge=fe=>{var xe=ur(),ce=a(xe);Ka(ce,{class:"w-5 h-5 text-red-500"});var te=r(ce,2),je=a(te,!0);t(te),t(xe),R(()=>c(je,e(x))),o(fe,xe)},jt=fe=>{var xe=V(),ce=m(xe);{var te=me=>{var Te=gr(),St=a(Te);{var Rt=W=>{var re=Ye("No rules match your filter.");o(W,re)},ae=W=>{var re=Ye("No rules found in Elastic.");o(W,re)};v(St,W=>{e(u)||e(k)!=="all"?W(Rt):W(ae,!1)})}t(Te),o(me,Te)},je=me=>{var Te=V(),St=m(Te);wa(St,17,()=>e(le),ka,(Rt,ae)=>{var W=mr(),re=a(W);xa(re),re.__change=()=>Ze(e(ae).rule_id);var nt=r(re,2),Ct=a(nt),Yt=a(Ct,!0);t(Ct);var Ot=r(Ct,2),zt=a(Ot,!0);t(Ot),t(nt);var Ge=r(nt,2),Zt=a(Ge,!0);t(Ge);var it=r(Ge,2),ea=a(it,!0);t(it);var S=r(it,2);{var C=p=>{var E=fr();o(p,E)},F=p=>{var E=xr();o(p,E)};v(S,p=>{e(ae).enabled?p(C):p(F,!1)})}t(W),R((p,E)=>{Ja(re,p),c(Yt,e(ae).name),c(zt,e(ae).rule_id),$a(Ge,1,`text-xs px-2 py-0.5 rounded font-medium flex-shrink-0 ${E??""}`),c(Zt,e(ae).severity),c(ea,e(ae).type)},[()=>e(b).has(e(ae).rule_id),()=>Tt(e(ae).severity)]),o(Rt,W)}),o(me,Te)};v(ce,me=>{e(le).length===0?me(te):me(je,!1)},!0)}o(fe,xe)};v(A,fe=>{e(x)?fe(ge):fe(jt,!1)},!0)}o(d,g)};v(Qt,d=>{e(T)?d(At):d(Kt,!1)})}t(wt);var $t=r(wt,2),kt=a($t),Wt=a(kt);t(kt);var Ft=r(kt,2),qt=a(Ft);qt.__click=function(...d){var g;(g=_.onclose)==null||g.apply(this,d)};var ot=r(qt,2);ot.__click=gt;var Xt=a(ot);t(ot);var s=r(ot,2);s.__click=tt;var n=a(s);da(n,{class:"w-4 h-4"});var M=r(n);t(s),t(Ft),t($t),t(ke),t(G),R(()=>{c(Dt,_.branch),c(Wt,`${e(J)??""} of ${e(N).length??""} rules selected`),c(Xt,`Export All (${e(N).length??""})`),s.disabled=e(J)===0,c(M,` Export Selected (${e(J)??""})`)}),Qa(Lt,()=>e(u),d=>i(u,d)),Ua(Be,()=>e(k),d=>i(k,d)),o(j,G)};v($,j=>{_.open&&j(q)})}o(L,K),ba()}Fa(["keydown","click","change"]);var br=l('<h1 class="text-3xl font-bold text-gray-900">Loading...</h1>'),wr=l('<p class="mt-1 text-sm text-gray-500"> </p>'),$r=l('<h1 class="text-3xl font-bold text-gray-900"> </h1> <!>',1),kr=l('<div class="flex items-center gap-2"><a class="inline-flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"><!> Edit</a> <button class="inline-flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 border border-red-200 rounded-lg transition-colors"><!></button></div>'),jr=l('<div class="alert bg-red-50 border border-red-200 rounded-lg p-4"><p class="text-sm text-red-800"> </p></div>'),Sr=l('<div class="alert bg-green-50 border border-green-200 rounded-lg p-4"><p class="text-sm text-green-800"> </p></div>'),Rr=l('<div class="flex items-center justify-center py-12"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div></div>'),Cr=l('<p class="text-xs text-gray-500"> </p>'),Nr=l("<!> Syncing...",1),Er=l("<!> Export to Git",1),Pr=l('<div class="space-y-3"><div class="flex items-center justify-between text-sm"><span class="text-gray-600">Rules:</span> <span class="font-semibold text-gray-900"> </span></div> <div class="flex items-center justify-between text-sm"><span class="text-gray-600">Branch:</span> <span class="font-mono text-xs bg-gray-100 px-2 py-0.5 rounded"> </span></div> <button class="btn w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 hover:shadow-md transition-all disabled:opacity-50 text-sm font-medium"><!></button></div>'),Mr=l('<p class="text-sm text-yellow-700">No environment configured</p>'),Tr=l('<div class="max-w-md"><div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4"><div class="flex items-center gap-2 mb-3"><div class="p-2 bg-yellow-100 rounded-lg"><!></div> <div><h3 class="font-semibold text-gray-900">Export to Git</h3> <!></div></div> <!></div></div> <div class="mt-6 pt-4 border-t border-gray-200"><h4 class="text-sm font-medium text-gray-700 mb-2">How it works:</h4> <ol class="text-sm text-gray-600 space-y-1"><li class="flex items-start gap-2"><span class="flex-shrink-0 w-5 h-5 bg-yellow-100 text-yellow-700 rounded-full flex items-center justify-center text-xs font-medium">1</span> <span>Export rules from <strong> </strong> to <code class="text-xs bg-gray-100 px-1 rounded"> </code> branch in Git</span></li></ol> <p class="text-xs text-gray-500 mt-2">This project is configured for one-way export only (Elastic to Git).</p></div>',1),Gr=l('<p class="text-xs text-gray-500"> </p>'),Lr=l("<!> Syncing...",1),Ar=l("<!> Export to Git",1),Fr=l('<div class="space-y-3"><div class="flex items-center justify-between text-sm"><span class="text-gray-600">Rules:</span> <span class="font-semibold text-gray-900"> </span></div> <div class="flex items-center justify-between text-sm"><span class="text-gray-600">Branch:</span> <span class="font-mono text-xs bg-gray-100 px-2 py-0.5 rounded"> </span></div> <button class="btn w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 hover:shadow-md transition-all disabled:opacity-50 text-sm font-medium"><!></button></div>'),qr=l('<p class="text-sm text-yellow-700">No test environment configured</p>'),Or=l("<!> Creating...",1),zr=l("<!> Create MR",1),Ur=l('<a target="_blank" class="block text-center text-xs text-blue-600 hover:underline">View open MRs <!></a>'),Jr=l('<div class="space-y-3"><div class="text-sm text-gray-600"><div class="flex items-center gap-2 mb-1"><!> <span class="font-mono text-xs"> </span></div> <div class="flex items-center justify-center"><!></div> <div class="flex items-center gap-2 mt-1"><!> <span class="font-mono text-xs"> </span></div></div> <button class="btn w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 hover:shadow-md transition-all disabled:opacity-50 text-sm font-medium"><!></button> <!></div>'),Dr=l('<p class="text-sm text-blue-700">Configure both environments</p>'),Br=l('<p class="text-xs text-gray-500"> </p>'),Hr=l("<!> Syncing...",1),Vr=l("<!> Import from Git",1),Ir=l('<div class="space-y-3"><div class="flex items-center justify-between text-sm"><span class="text-gray-600">Rules:</span> <span class="font-semibold text-gray-900"> </span></div> <div class="flex items-center justify-between text-sm"><span class="text-gray-600">Branch:</span> <span class="font-mono text-xs bg-gray-100 px-2 py-0.5 rounded"> </span></div> <button class="btn w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 hover:shadow-md transition-all disabled:opacity-50 text-sm font-medium"><!></button></div>'),Qr=l('<p class="text-sm text-green-700">No prod environment configured</p>'),Kr=l('<div class="flex items-stretch gap-4"><div class="flex-1 bg-yellow-50 border border-yellow-200 rounded-lg p-4"><div class="flex items-center gap-2 mb-3"><div class="p-2 bg-yellow-100 rounded-lg"><!></div> <div><h3 class="font-semibold text-gray-900">Test Environment</h3> <!></div></div> <!></div> <div class="flex items-center"><!></div> <div class="flex-1 bg-blue-50 border border-blue-200 rounded-lg p-4"><div class="flex items-center gap-2 mb-3"><div class="p-2 bg-blue-100 rounded-lg"><!></div> <div><h3 class="font-semibold text-gray-900">Merge Request</h3> <p class="text-xs text-gray-500">Review & Approve</p></div></div> <!></div> <div class="flex items-center"><!></div> <div class="flex-1 bg-green-50 border border-green-200 rounded-lg p-4"><div class="flex items-center gap-2 mb-3"><div class="p-2 bg-green-100 rounded-lg"><!></div> <div><h3 class="font-semibold text-gray-900">Production</h3> <!></div></div> <!></div></div> <div class="mt-6 pt-4 border-t border-gray-200"><h4 class="text-sm font-medium text-gray-700 mb-2">How it works:</h4> <ol class="text-sm text-gray-600 space-y-1"><li class="flex items-start gap-2"><span class="flex-shrink-0 w-5 h-5 bg-yellow-100 text-yellow-700 rounded-full flex items-center justify-center text-xs font-medium">1</span> <span>Export rules from <strong> </strong> to <code class="text-xs bg-gray-100 px-1 rounded"> </code> branch</span></li> <li class="flex items-start gap-2"><span class="flex-shrink-0 w-5 h-5 bg-blue-100 text-blue-700 rounded-full flex items-center justify-center text-xs font-medium">2</span> <span>Create MR from <code class="text-xs bg-gray-100 px-1 rounded"> </code> to <code class="text-xs bg-gray-100 px-1 rounded"> </code>, review and merge</span></li> <li class="flex items-start gap-2"><span class="flex-shrink-0 w-5 h-5 bg-green-100 text-green-700 rounded-full flex items-center justify-center text-xs font-medium">3</span> <span>Import rules from <code class="text-xs bg-gray-100 px-1 rounded"> </code> branch to <strong> </strong></span></li></ol></div>',1),Wr=l('<p class="text-sm text-gray-500">No sync jobs yet. Start by exporting from Test.</p>'),Xr=l('<span class="text-xs text-gray-500 ml-2"> <!> <!></span>'),Yr=l('<div class="flex items-center justify-between py-2 px-3 bg-gray-50 rounded-lg"><div class="flex items-center gap-3"><!> <div><span class="text-sm font-medium text-gray-900"><!></span> <!></div></div> <div class="text-right"><span> </span> <p class="text-xs text-gray-500 mt-1"> </p></div></div>'),Zr=l('<div class="space-y-2"></div>'),es=l('<a target="_blank" class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"><div class="p-2 bg-orange-100 rounded"><!></div> <div class="flex-1 min-w-0"><div class="text-sm font-medium text-gray-900">Kibana Rules</div> <div class="text-xs text-gray-500 truncate"> </div></div> <!></a>'),ts=l('<a target="_blank" class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"><div class="p-2 bg-purple-100 rounded"><!></div> <div class="flex-1 min-w-0"><div class="text-sm font-medium text-gray-900">Git Repository</div> <div class="text-xs text-gray-500 truncate"> </div></div> <!></a> <a target="_blank" class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"><div class="p-2 bg-blue-100 rounded"><!></div> <div class="flex-1 min-w-0"><div class="text-sm font-medium text-gray-900">Merge Requests</div> <div class="text-xs text-gray-500">View open MRs</div></div> <!></a>',1),as=l('<div class="card p-6 animate-fade-in" style="animation-delay: 100ms; opacity: 0;"><h2 class="text-lg font-semibold text-gray-900 mb-6">Sync Workflow</h2> <!></div> <div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-2 card p-6 animate-fade-in" style="animation-delay: 200ms; opacity: 0;"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-semibold text-gray-900">Recent Syncs</h3> <button class="text-gray-500 hover:text-gray-700"><!></button></div> <!></div> <div class="card p-6 animate-fade-in" style="animation-delay: 250ms; opacity: 0;"><h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Links</h3> <div class="space-y-3"><!> <!></div> <div class="mt-4 pt-4 border-t border-gray-200 text-xs text-gray-500 space-y-1"><div><strong>Path:</strong> </div> <div><strong>Created:</strong> </div></div></div></div>',1),rs=l('<div class="space-y-6"><div class="flex items-center justify-between animate-fade-in"><div><a href="/projects" class="inline-flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900 mb-2 transition-colors duration-200"><!> Back to Projects</a> <!></div> <!></div> <!> <!> <!></div> <!>',1);function Ns(L,_){ha(_,!0);const N=()=>Ha(Va,"$page",b),[b,T]=Ba();let x=U(null),u=U(Jt([])),k=U(Jt([])),le=U(!0),J=U(""),de=U(""),Pe=U(!1),Ze=U(!1),et=U(!1),tt=U(!1),gt=U(0),Tt=U(0),K=$e(()=>N().params.id),$=$e(()=>e(u).find(s=>s.name==="test")),q=$e(()=>e(u).find(s=>s.name==="production")),j=$e(()=>{var s;return((s=e(x))==null?void 0:s.sync_mode)==="export_only"});Aa(async()=>{await G()});async function G(){try{i(le,!0),await Promise.all([ke(),ft(),Me(),at()])}finally{i(le,!1)}}async function ke(){try{i(x,await we.collection("projects").getOne(e(K),{expand:"elastic_instance,git_repository"}),!0)}catch(s){i(J,s.message,!0)}}async function ft(){try{i(u,await we.collection("environments").getFullList({filter:`project = "${e(K)}"`}),!0)}catch(s){console.error("Failed to load environments:",s)}}async function Me(){try{i(k,await we.collection("sync_jobs").getFullList({filter:`project = "${e(K)}"`,sort:"-created",perPage:10}),!0)}catch(s){console.error("Failed to load sync jobs:",s)}}async function at(){try{const s=await fetch(`${we.baseUrl}/api/project/${e(K)}/metrics`);if(s.ok){const n=await s.json();i(gt,n.test_rules||0,!0),i(Tt,n.prod_rules||0,!0)}}catch(s){console.error("Failed to load metrics:",s)}}function xt(){i(tt,!0)}async function Dt(s){if(i(tt,!1),!!e($))try{i(Pe,!0),i(J,""),i(de,"");const n={project_id:e(K),environment_id:e($).id,direction:"elastic_to_git",branch:e($).git_branch,space:e($).elastic_space};s!==null&&(n.rule_ids=s);const d=await(await fetch(`${we.baseUrl}/api/sync/trigger`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json();d.success?(i(de,d.message,!0),await Me(),await at()):i(J,d.message||"Failed to sync",!0)}catch(n){i(J,n.message,!0)}finally{i(Pe,!1)}}async function mt(){if(!(!e($)||!e(q)))try{i(et,!0),i(J,""),i(de,"");const n=await(await fetch(`${we.baseUrl}/api/merge-request/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:e(K),source_branch:e($).git_branch,target_branch:e(q).git_branch,title:`[Elastic Git Sync] Promote rules from ${e($).elastic_space} to ${e(q).elastic_space}`})})).json();if(n.success&&n.url){let M="Merge Request created!";n.conflicts_resolved&&(M+=` (${n.conflicts_count||"all"} conflicts auto-resolved)`),M+=" Opening in new tab...",i(de,M,!0),window.open(n.url,"_blank")}else i(J,n.message||"Failed to create Merge Request",!0)}catch(s){i(J,s.message,!0)}finally{i(et,!1)}}async function Bt(){if(e(q))try{i(Ze,!0),i(J,""),i(de,"");const n=await(await fetch(`${we.baseUrl}/api/sync/trigger`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:e(K),environment_id:e(q).id,direction:"git_to_elastic",branch:e(q).git_branch,space:e(q).elastic_space})})).json();n.success?(i(de,n.message,!0),await Me(),await at()):i(J,n.message||"Failed to sync",!0)}catch(s){i(J,s.message,!0)}finally{i(Ze,!1)}}async function yt(){if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{for(const s of e(u))await we.collection("environments").delete(s.id);await we.collection("projects").delete(e(K)),Ia("/projects")}catch(s){i(J,s.message,!0)}}function ht(s){switch(s){case"completed":return"text-green-600";case"failed":return"text-red-600";case"running":return"text-blue-600";default:return"text-gray-600"}}function Gt(s){switch(s){case"completed":return"bg-green-100";case"failed":return"bg-red-100";case"running":return"bg-blue-100";default:return"bg-gray-100"}}function Lt(s){if(!s)return"Never";const n=new Date(s),d=new Date().getTime()-n.getTime(),g=Math.floor(d/6e4);if(g<1)return"Just now";if(g<60)return`${g}m ago`;const A=Math.floor(g/60);return A<24?`${A}h ago`:`${Math.floor(A/24)}d ago`}function Be(s){return(s==null?void 0:s.replace(/\.git$/,""))||""}var rt=rs();Da("ffmenf",s=>{Oa(()=>{var n;za.title=`${(((n=e(x))==null?void 0:n.name)||"Project")??""} - Elastic Git Sync`})});var He=m(rt),Ve=a(He),Ie=a(Ve),st=a(Ie),bt=a(st);Wa(bt,{class:"w-4 h-4 transition-transform duration-200 hover:-translate-x-1"}),z(),t(st);var Ht=r(st,2);{var Vt=s=>{var n=br();o(s,n)},It=s=>{var n=V(),M=m(n);{var d=g=>{var A=$r(),ge=m(A),jt=a(ge,!0);t(ge);var fe=r(ge,2);{var xe=ce=>{var te=wr(),je=a(te,!0);t(te),R(()=>c(je,e(x).description)),o(ce,te)};v(fe,ce=>{e(x).description&&ce(xe)})}R(()=>c(jt,e(x).name)),o(g,A)};v(M,g=>{e(x)&&g(d)},!0)}o(s,n)};v(Ht,s=>{e(le)?s(Vt):s(It,!1)})}t(Ie);var wt=r(Ie,2);{var Qt=s=>{var n=kr(),M=a(n),d=a(M);Xa(d,{class:"w-4 h-4"}),z(),t(M);var g=r(M,2),A=a(g);Za(A,{class:"w-4 h-4"}),t(g),t(n),R(()=>Mt(M,"href",`/projects/${e(K)??""}/edit`)),_t("click",g,yt),o(s,n)};v(wt,s=>{e(x)&&s(Qt)})}t(Ve);var At=r(Ve,2);{var Kt=s=>{var n=jr(),M=a(n),d=a(M,!0);t(M),t(n),R(()=>c(d,e(J))),o(s,n)};v(At,s=>{e(J)&&s(Kt)})}var $t=r(At,2);{var kt=s=>{var n=Sr(),M=a(n),d=a(M,!0);t(M),t(n),R(()=>c(d,e(de))),o(s,n)};v($t,s=>{e(de)&&s(kt)})}var Wt=r($t,2);{var Ft=s=>{var n=Rr();o(s,n)},qt=s=>{var n=V(),M=m(n);{var d=g=>{var A=as(),ge=m(A),jt=r(a(ge),2);{var fe=S=>{var C=Tr(),F=m(C),p=a(F),E=a(p),D=a(E),X=a(D);ma(X,{class:"w-5 h-5 text-yellow-600"}),t(D);var se=r(D,2),Se=r(a(se),2);{var Le=f=>{var y=Cr(),B=a(y,!0);t(y),R(()=>c(B,e($).elastic_space)),o(f,y)};v(Se,f=>{e($)&&f(Le)})}t(se),t(E);var ve=r(E,2);{var Re=f=>{var y=Pr(),B=a(y),oe=r(a(B),2),ne=a(oe,!0);t(oe),t(B);var P=r(B,2),Y=r(a(P),2),Fe=a(Y,!0);t(Y),t(P);var I=r(P,2),_e=a(I);{var he=qe=>{var Oe=Nr(),dt=m(Oe);ut(dt,{class:"w-4 h-4 animate-spin"}),z(),o(qe,Oe)},ta=qe=>{var Oe=Er(),dt=m(Oe);da(dt,{class:"w-4 h-4"}),z(),o(qe,Oe)};v(_e,qe=>{e(Pe)?qe(he):qe(ta,!1)})}t(I),t(y),R(()=>{c(ne,e(gt)),c(Fe,e($).git_branch),I.disabled=e(Pe)}),_t("click",I,xt),o(f,y)},Qe=f=>{var y=Mr();o(f,y)};v(ve,f=>{e($)?f(Re):f(Qe,!1)})}t(p),t(F);var ye=r(F,2),lt=r(a(ye),2),Ae=a(lt),Ce=r(a(Ae),2),pe=r(a(Ce)),Nt=a(pe,!0);t(pe);var Ke=r(pe,2),Et=a(Ke,!0);t(Ke),z(),t(Ce),t(Ae),t(lt),z(2),t(ye),R(()=>{var f,y;c(Nt,((f=e($))==null?void 0:f.elastic_space)||"Elastic"),c(Et,((y=e($))==null?void 0:y.git_branch)||"main")}),o(S,C)},xe=S=>{var C=Kr(),F=m(C),p=a(F),E=a(p),D=a(E),X=a(D);ma(X,{class:"w-5 h-5 text-yellow-600"}),t(D);var se=r(D,2),Se=r(a(se),2);{var Le=h=>{var w=Gr(),O=a(w,!0);t(w),R(()=>c(O,e($).elastic_space)),o(h,w)};v(Se,h=>{e($)&&h(Le)})}t(se),t(E);var ve=r(E,2);{var Re=h=>{var w=Fr(),O=a(w),ie=r(a(O),2),Ne=a(ie,!0);t(ie),t(O);var Z=r(O,2),We=r(a(Z),2),Xe=a(We,!0);t(We),t(Z);var ue=r(Z,2),ct=a(ue);{var vt=Q=>{var H=Lr(),Ee=m(H);ut(Ee,{class:"w-4 h-4 animate-spin"}),z(),o(Q,H)},pt=Q=>{var H=Ar(),Ee=m(H);da(Ee,{class:"w-4 h-4"}),z(),o(Q,H)};v(ct,Q=>{e(Pe)?Q(vt):Q(pt,!1)})}t(ue),t(w),R(()=>{c(Ne,e(gt)),c(Xe,e($).git_branch),ue.disabled=e(Pe)}),_t("click",ue,xt),o(h,w)},Qe=h=>{var w=qr();o(h,w)};v(ve,h=>{e($)?h(Re):h(Qe,!1)})}t(p);var ye=r(p,2),lt=a(ye);ya(lt,{class:"w-8 h-8 text-gray-300"}),t(ye);var Ae=r(ye,2),Ce=a(Ae),pe=a(Ce),Nt=a(pe);la(Nt,{class:"w-5 h-5 text-blue-600"}),t(pe),z(2),t(Ce);var Ke=r(Ce,2);{var Et=h=>{var w=Jr(),O=a(w),ie=a(O),Ne=a(ie);ia(Ne,{class:"w-4 h-4"});var Z=r(Ne,2),We=a(Z,!0);t(Z),t(ie);var Xe=r(ie,2),ue=a(Xe);or(ue,{class:"w-4 h-4 text-gray-400"}),t(Xe);var ct=r(Xe,2),vt=a(ct);ia(vt,{class:"w-4 h-4"});var pt=r(vt,2),Q=a(pt,!0);t(pt),t(ct),t(O);var H=r(O,2),Ee=a(H);{var Pa=be=>{var ee=Or(),Pt=m(ee);ut(Pt,{class:"w-4 h-4 animate-spin"}),z(),o(be,ee)},Ma=be=>{var ee=zr(),Pt=m(ee);la(Pt,{class:"w-4 h-4"}),z(),o(be,ee)};v(Ee,be=>{e(et)?be(Pa):be(Ma,!1)})}t(H);var Ta=r(H,2);{var Ga=be=>{var ee=Ur(),Pt=r(a(ee));Ut(Pt,{class:"w-3 h-3 inline"}),t(ee),R(La=>Mt(ee,"href",`${La??""}/-/merge_requests`),[()=>Be(e(x).expand.git_repository.url)]),o(be,ee)};v(Ta,be=>{var ee;(ee=e(x).expand)!=null&&ee.git_repository&&be(Ga)})}t(w),R(()=>{c(We,e($).git_branch),c(Q,e(q).git_branch),H.disabled=e(et)}),_t("click",H,mt),o(h,w)},f=h=>{var w=Dr();o(h,w)};v(Ke,h=>{e($)&&e(q)?h(Et):h(f,!1)})}t(Ae);var y=r(Ae,2),B=a(y);ya(B,{class:"w-8 h-8 text-gray-300"}),t(y);var oe=r(y,2),ne=a(oe),P=a(ne),Y=a(P);er(Y,{class:"w-5 h-5 text-green-600"}),t(P);var Fe=r(P,2),I=r(a(Fe),2);{var _e=h=>{var w=Br(),O=a(w,!0);t(w),R(()=>c(O,e(q).elastic_space)),o(h,w)};v(I,h=>{e(q)&&h(_e)})}t(Fe),t(ne);var he=r(ne,2);{var ta=h=>{var w=Ir(),O=a(w),ie=r(a(O),2),Ne=a(ie,!0);t(ie),t(O);var Z=r(O,2),We=r(a(Z),2),Xe=a(We,!0);t(We),t(Z);var ue=r(Z,2),ct=a(ue);{var vt=Q=>{var H=Hr(),Ee=m(H);ut(Ee,{class:"w-4 h-4 animate-spin"}),z(),o(Q,H)},pt=Q=>{var H=Vr(),Ee=m(H);nr(Ee,{class:"w-4 h-4"}),z(),o(Q,H)};v(ct,Q=>{e(Ze)?Q(vt):Q(pt,!1)})}t(ue),t(w),R(()=>{c(Ne,e(Tt)),c(Xe,e(q).git_branch),ue.disabled=e(Ze)}),_t("click",ue,Bt),o(h,w)},qe=h=>{var w=Qr();o(h,w)};v(he,h=>{e(q)?h(ta):h(qe,!1)})}t(oe),t(F);var Oe=r(F,2),dt=r(a(Oe),2),aa=a(dt),ca=r(a(aa),2),ra=r(a(ca)),ja=a(ra,!0);t(ra);var va=r(ra,2),Sa=a(va,!0);t(va),z(),t(ca),t(aa);var sa=r(aa,2),pa=r(a(sa),2),oa=r(a(pa)),Ra=a(oa,!0);t(oa);var _a=r(oa,2),Ca=a(_a,!0);t(_a),z(),t(pa),t(sa);var ua=r(sa,2),ga=r(a(ua),2),na=r(a(ga)),Na=a(na,!0);t(na);var fa=r(na,2),Ea=a(fa,!0);t(fa),t(ga),t(ua),t(dt),t(Oe),R(()=>{var h,w,O,ie,Ne,Z;c(ja,((h=e($))==null?void 0:h.elastic_space)||"Test"),c(Sa,((w=e($))==null?void 0:w.git_branch)||"develop"),c(Ra,((O=e($))==null?void 0:O.git_branch)||"develop"),c(Ca,((ie=e(q))==null?void 0:ie.git_branch)||"main"),c(Na,((Ne=e(q))==null?void 0:Ne.git_branch)||"main"),c(Ea,((Z=e(q))==null?void 0:Z.elastic_space)||"Production")}),o(S,C)};v(jt,S=>{e(j)?S(fe):S(xe,!1)})}t(ge);var ce=r(ge,2),te=a(ce),je=a(te),me=r(a(je),2),Te=a(me);Ya(Te,{class:"w-4 h-4"}),t(me),t(je);var St=r(je,2);{var Rt=S=>{var C=Wr();o(S,C)},ae=S=>{var C=Zr();wa(C,21,()=>e(k).slice(0,5),ka,(F,p)=>{var E=Yr(),D=a(E),X=a(D);{var se=f=>{tr(f,{class:"w-4 h-4 text-green-600"})},Se=f=>{var y=V(),B=m(y);{var oe=P=>{rr(P,{class:"w-4 h-4 text-red-600"})},ne=P=>{var Y=V(),Fe=m(Y);{var I=he=>{ut(he,{class:"w-4 h-4 text-blue-600 animate-spin"})},_e=he=>{sr(he,{class:"w-4 h-4 text-yellow-600"})};v(Fe,he=>{e(p).status==="running"?he(I):he(_e,!1)},!0)}o(P,Y)};v(B,P=>{e(p).status==="failed"?P(oe):P(ne,!1)},!0)}o(f,y)};v(X,f=>{e(p).status==="completed"?f(se):f(Se,!1)})}var Le=r(X,2),ve=a(Le),Re=a(ve);{var Qe=f=>{var y=Ye("Export to Git");o(f,y)},ye=f=>{var y=V(),B=m(y);{var oe=P=>{var Y=Ye("Import from Git");o(P,Y)},ne=P=>{var Y=Ye("Bidirectional");o(P,Y)};v(B,P=>{e(p).direction==="git_to_elastic"?P(oe):P(ne,!1)},!0)}o(f,y)};v(Re,f=>{e(p).direction==="elastic_to_git"?f(Qe):f(ye,!1)})}t(ve);var lt=r(ve,2);{var Ae=f=>{const y=$e(()=>typeof e(p).changes_summary=="string"?JSON.parse(e(p).changes_summary):e(p).changes_summary);var B=Xr(),oe=a(B),ne=r(oe);{var P=I=>{var _e=Ye();R(()=>c(_e,`, ${e(y).deleted??""} deleted`)),o(I,_e)};v(ne,I=>{e(y).deleted&&I(P)})}var Y=r(ne,2);{var Fe=I=>{var _e=Ye();R(()=>c(_e,`, ${e(y).imported??""} imported`)),o(I,_e)};v(Y,I=>{e(y).imported&&I(Fe)})}t(B),R(()=>c(oe,`${(e(y).exported||0)??""} exported `)),o(f,B)};v(lt,f=>{e(p).changes_summary&&f(Ae)})}t(Le),t(D);var Ce=r(D,2),pe=a(Ce),Nt=a(pe,!0);t(pe);var Ke=r(pe,2),Et=a(Ke,!0);t(Ke),t(Ce),t(E),R((f,y,B)=>{$a(pe,1,`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${f??""} ${y??""}`),c(Nt,e(p).status),c(Et,B)},[()=>Gt(e(p).status),()=>ht(e(p).status),()=>Lt(e(p).created)]),o(F,E)}),t(C),o(S,C)};v(St,S=>{e(k).length===0?S(Rt):S(ae,!1)})}t(te);var W=r(te,2),re=r(a(W),2),nt=a(re);{var Ct=S=>{const C=$e(()=>e(x).expand.elastic_instance.url);var F=es(),p=a(F),E=a(p);ar(E,{class:"w-4 h-4 text-orange-600"}),t(p);var D=r(p,2),X=r(a(D),2),se=a(X,!0);t(X),t(D);var Se=r(D,2);Ut(Se,{class:"w-4 h-4 text-gray-400"}),t(F),R(()=>{Mt(F,"href",`${e(C)??""}/app/security/rules`),c(se,e(x).expand.elastic_instance.name)}),o(S,F)};v(nt,S=>{var C;(C=e(x).expand)!=null&&C.elastic_instance&&S(Ct)})}var Yt=r(nt,2);{var Ot=S=>{const C=$e(()=>Be(e(x).expand.git_repository.url));var F=ts(),p=m(F),E=a(p),D=a(E);ia(D,{class:"w-4 h-4 text-purple-600"}),t(E);var X=r(E,2),se=r(a(X),2),Se=a(se,!0);t(se),t(X);var Le=r(X,2);Ut(Le,{class:"w-4 h-4 text-gray-400"}),t(p);var ve=r(p,2),Re=a(ve),Qe=a(Re);la(Qe,{class:"w-4 h-4 text-blue-600"}),t(Re);var ye=r(Re,4);Ut(ye,{class:"w-4 h-4 text-gray-400"}),t(ve),R(()=>{Mt(p,"href",e(C)),c(Se,e(x).expand.git_repository.name),Mt(ve,"href",`${e(C)??""}/-/merge_requests`)}),o(S,F)};v(Yt,S=>{var C;(C=e(x).expand)!=null&&C.git_repository&&S(Ot)})}t(re);var zt=r(re,2),Ge=a(zt),Zt=r(a(Ge));t(Ge);var it=r(Ge,2),ea=r(a(it));t(it),t(zt),t(W),t(ce),R(S=>{c(Zt,` ${(e(x).git_path||"/")??""}`),c(ea,` ${S??""}`)},[()=>new Date(e(x).created).toLocaleDateString()]),_t("click",me,Me),o(g,A)};v(M,g=>{e(x)&&g(d)},!0)}o(s,n)};v(Wt,s=>{e(le)?s(Ft):s(qt,!1)})}t(He);var ot=r(He,2);{var Xt=s=>{hr(s,{get open(){return e(tt)},get projectId(){return e(K)},get space(){return e($).elastic_space},get branch(){return e($).git_branch},onexport:Dt,onclose:()=>i(tt,!1)})};v(ot,s=>{e($)&&s(Xt)})}o(L,rt),ba(),T()}export{Ns as component};

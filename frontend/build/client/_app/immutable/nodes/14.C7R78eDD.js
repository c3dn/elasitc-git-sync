import"../chunks/CWj6FrbW.js";import{i as ze}from"../chunks/CVSZYhH1.js";import{o as Ke,s as m}from"../chunks/BCkVnCXK.js";import{p as Qe,a as c,b as Ve,e as We,d as C,s as a,$ as Xe,h as i,i as e,g as o,r as s,m as v,n as k,j as O,t as z,l as Ze,c as Ce,f as Re,k as ie}from"../chunks/Dwc5JcvW.js";import{i as u}from"../chunks/BGM91MK6.js";import{r as K,a as $e,c as et,e as tt,b as rt,i as at}from"../chunks/De-PL9gO.js";import{h as st}from"../chunks/--Il8l-M.js";import{b as oe,a as it}from"../chunks/-5BAYQkN.js";import{p as U}from"../chunks/BXxF3ZQE.js";import{P as ot}from"../chunks/BJl2rFxH.js";import{L as je}from"../chunks/q1IplmyU.js";import{R as Ae,P as nt}from"../chunks/CBtbhsoy.js";import{T as lt}from"../chunks/BImVJdth.js";import{C as ct}from"../chunks/CSkvpjDh.js";import{C as dt}from"../chunks/fDTQ2geM.js";var vt=C('<button class="inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors"><!> Add Git Repository</button>'),pt=C('<div class="mb-4 bg-red-50 border border-red-200 rounded-lg p-4"><p class="text-sm text-red-800"> </p></div>'),ut=C('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><h3 class="text-lg font-semibold text-gray-900 mb-4"> </h3> <!> <div class="space-y-4"><div><label for="name" class="block text-sm font-medium text-gray-700 mb-2">Repository Name *</label> <input id="name" type="text" placeholder="Security Rules Repository" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"/></div> <div><label for="provider" class="block text-sm font-medium text-gray-700 mb-2">Provider *</label> <select id="provider" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"><option>GitLab</option><option>GitHub</option><option>Generic Git</option></select></div> <div><label for="url" class="block text-sm font-medium text-gray-700 mb-2">Repository URL *</label> <input id="url" type="url" placeholder="https://gitlab.com/your-org/security-rules" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"/> <p class="text-xs text-gray-500 mt-1">Full HTTPS URL to your Git repository</p></div> <div><label for="token" class="block text-sm font-medium text-gray-700 mb-2"> </label> <input id="token" type="password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"/> <p class="text-xs text-gray-500 mt-1"><!></p></div> <div><label for="branch" class="block text-sm font-medium text-gray-700 mb-2">Default Branch *</label> <input id="branch" type="text" placeholder="main" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"/></div> <div><label for="base-path" class="block text-sm font-medium text-gray-700 mb-2">Base Path (optional)</label> <input id="base-path" type="text" placeholder="rules/" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"/> <p class="text-xs text-gray-500 mt-1">Default subdirectory for storing rules</p></div> <div class="flex items-center gap-2"><input id="is-active" type="checkbox" class="w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-600"/> <label for="is-active" class="text-sm font-medium text-gray-700">Active</label></div> <div class="flex items-center gap-3 pt-4"><button class="inline-flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"><!> Test Connection</button> <button class="inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"><!></button> <button class="px-4 py-2 text-gray-700 hover:text-gray-900 transition-colors">Cancel</button></div></div></div>'),bt=C('<div class="flex items-center justify-center py-12"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"></div></div>'),ft=C('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"><p class="text-gray-500">No Git repositories configured yet.</p></div>'),mt=C('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="flex items-start justify-between"><div class="flex-1"><div class="flex items-center gap-3 mb-2"><h3 class="text-lg font-semibold text-gray-900"> </h3> <!> <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800"> </span></div> <p class="text-sm text-gray-600 mb-1"> </p> <p class="text-xs text-gray-500"> <!></p></div> <div class="flex items-center gap-2"><span> </span></div></div> <div class="flex items-center gap-2 mt-4 pt-4 border-t border-gray-200"><button class="inline-flex items-center gap-2 px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm"><!> Test Connection</button> <button class="inline-flex items-center gap-2 px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm"><!> Edit</button> <button class="ml-auto inline-flex items-center gap-2 px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors text-sm"><!> Delete</button></div></div>'),gt=C('<div class="space-y-4"></div>'),_t=C('<div class="space-y-6"><!> <!> <!></div>');function Ot(Fe,Le){Qe(Le,!1);let ne=v([]),B=v(!1),R=v(!1),le=v(!1),f=v(""),g=v(null),D=v(""),y=v(""),_=v("gitlab"),x=v(""),E=v("main"),Q=v(""),V=v(!0);Ke(async()=>{await ce()});async function ce(){try{a(R,!0),a(ne,await U.collection("git_repositories").getFullList({sort:"-created"}))}catch(r){a(f,r.message)}finally{a(R,!1)}}function Te(){a(D,""),a(y,""),a(_,"gitlab"),a(x,""),a(E,"main"),a(Q,""),a(V,!0),a(g,null),a(f,"")}function Oe(){Te(),a(B,!0)}function Ue(r){a(g,r.id),a(D,r.name),a(y,r.url),a(_,r.provider),a(x,r.access_token),a(E,r.default_branch),a(Q,r.base_path||""),a(V,r.is_active),a(f,""),a(B,!0)}function Pe(){a(B,!1),Te()}async function Be(){var r;try{a(le,!0),a(f,"");const d=await(await fetch(`${U.baseUrl}/api/connection/test`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"git",config:{url:e(y),provider:e(_),access_token:e(x)}})})).json();d.success?alert(`Connection successful! Found ${((r=d.branches)==null?void 0:r.length)||0} branches.`):a(f,d.message)}catch(n){a(f,n.message)}finally{a(le,!1)}}async function De(){try{a(R,!0),a(f,"");const r={name:e(D),url:e(y),provider:e(_),access_token:e(x),default_branch:e(E),base_path:e(Q)||"",is_active:e(V)};e(g)?await U.collection("git_repositories").update(e(g),r):await U.collection("git_repositories").create(r),Pe(),await ce()}catch(r){a(f,r.message)}finally{a(R,!1)}}async function Ee(r){if(confirm("Are you sure you want to delete this repository?"))try{await U.collection("git_repositories").delete(r),await ce()}catch(n){alert(`Error: ${n.message}`)}}async function Ie(r){try{const d=await(await fetch(`${U.baseUrl}/api/connection/test`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"git",config:{url:r.url,provider:r.provider,access_token:r.access_token}})})).json();await U.collection("git_repositories").update(r.id,{connection_status:d.success?"success":"failed",last_connection_test:new Date().toISOString()}),await ce()}catch(n){console.error("Connection test failed:",n)}}ze();var me=_t();st("xtvn8n",r=>{We(()=>{Xe.title="Git Repositories - Settings"})});var Ge=i(me);{var Ne=r=>{var n=vt(),d=i(n);ot(d,{class:"w-5 h-5"}),k(),s(n),O("click",n,Oe),c(r,n)};u(Ge,r=>{e(B)||r(Ne)})}var Se=o(Ge,2);{var He=r=>{var n=ut(),d=i(n),ge=i(d,!0);s(d);var de=o(d,2);{var h=t=>{var b=pt(),fe=i(b),we=i(fe,!0);s(fe),s(b),z(()=>m(we,e(f))),c(t,b)};u(de,t=>{e(f)&&t(h)})}var w=o(de,2),W=i(w),l=o(i(W),2);K(l),s(W);var T=o(W,2),P=o(i(T),2);z(()=>{e(_),Ze(()=>{})});var G=i(P);G.value=G.__value="gitlab";var S=o(G);S.value=S.__value="github";var I=o(S);I.value=I.__value="generic",s(P),s(T);var X=o(T,2),Z=o(i(X),2);K(Z),k(2),s(X);var $=o(X,2),ee=i($),ve=i(ee);s(ee);var N=o(ee,2);K(N);var H=o(N,2),_e=i(H);{var pe=t=>{var b=ie("Create a project access token with API and write_repository scopes");c(t,b)},ue=t=>{var b=Ce(),fe=Re(b);{var we=q=>{var ke=ie("Create a personal access token with repo scope");c(q,ke)},qe=q=>{var ke=ie("Token for authentication");c(q,ke)};u(fe,q=>{e(_)==="github"?q(we):q(qe,!1)},!0)}c(t,b)};u(_e,t=>{e(_)==="gitlab"?t(pe):t(ue,!1)})}s(H),s($);var te=o($,2),be=o(i(te),2);K(be),s(te);var J=o(te,2),M=o(i(J),2);K(M),k(2),s(J);var re=o(J,2),ae=i(re);K(ae),k(2),s(re);var j=o(re,2),A=i(j),Y=i(A);{var ye=t=>{je(t,{class:"w-4 h-4 animate-spin"})},se=t=>{Ae(t,{class:"w-4 h-4"})};u(Y,t=>{e(le)?t(ye):t(se,!1)})}k(),s(A);var F=o(A,2),p=i(F);{var L=t=>{je(t,{class:"w-4 h-4 animate-spin"})},xe=t=>{var b=ie();z(()=>m(b,e(g)?"Update":"Save")),c(t,b)};u(p,t=>{e(R)?t(L):t(xe,!1)})}s(F);var he=o(F,2);s(j),s(w),s(n),z(()=>{m(ge,e(g)?"Edit Git Repository":"Add Git Repository"),m(ve,`Access Token ${e(g)?"(leave empty to keep current)":"*"}`),$e(N,"placeholder",e(g)?"••••••••":"Your Git access token"),A.disabled=!e(y)||!e(x)||e(le),F.disabled=e(R)||!e(D)||!e(y)||!e(g)&&!e(x)||!e(E)}),oe(l,()=>e(D),t=>a(D,t)),et(P,()=>e(_),t=>a(_,t)),oe(Z,()=>e(y),t=>a(y,t)),oe(N,()=>e(x),t=>a(x,t)),oe(be,()=>e(E),t=>a(E,t)),oe(M,()=>e(Q),t=>a(Q,t)),it(ae,()=>e(V),t=>a(V,t)),O("click",A,Be),O("click",F,De),O("click",he,Pe),c(r,n)};u(Se,r=>{e(B)&&r(He)})}var Je=o(Se,2);{var Me=r=>{var n=bt();c(r,n)},Ye=r=>{var n=Ce(),d=Re(n);{var ge=h=>{var w=ft();c(h,w)},de=h=>{var w=gt();tt(w,5,()=>e(ne),at,(W,l)=>{var T=mt(),P=i(T),G=i(P),S=i(G),I=i(S),X=i(I,!0);s(I);var Z=o(I,2);{var $=p=>{ct(p,{class:"w-5 h-5 text-green-600"})},ee=p=>{var L=Ce(),xe=Re(L);{var he=t=>{dt(t,{class:"w-5 h-5 text-red-600"})};u(xe,t=>{e(l).connection_status==="failed"&&t(he)},!0)}c(p,L)};u(Z,p=>{e(l).connection_status==="success"?p($):p(ee,!1)})}var ve=o(Z,2),N=i(ve,!0);s(ve),s(S);var H=o(S,2),_e=i(H,!0);s(H);var pe=o(H,2),ue=i(pe),te=o(ue);{var be=p=>{var L=ie();z(()=>m(L,`• Path: ${e(l).base_path??""}`)),c(p,L)};u(te,p=>{e(l).base_path&&p(be)})}s(pe),s(G);var J=o(G,2),M=i(J),re=i(M,!0);s(M),s(J),s(P);var ae=o(P,2),j=i(ae),A=i(j);Ae(A,{class:"w-4 h-4"}),k(),s(j);var Y=o(j,2),ye=i(Y);nt(ye,{class:"w-4 h-4"}),k(),s(Y);var se=o(Y,2),F=i(se);lt(F,{class:"w-4 h-4"}),k(),s(se),s(ae),s(T),z(()=>{m(X,e(l).name),m(N,e(l).provider),m(_e,e(l).url),m(ue,`Branch: ${e(l).default_branch??""} `),rt(M,1,`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
								${e(l).is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`),m(re,e(l).is_active?"Active":"Inactive")}),O("click",j,()=>Ie(e(l))),O("click",Y,()=>Ue(e(l))),O("click",se,()=>Ee(e(l).id)),c(W,T)}),s(w),c(h,w)};u(d,h=>{e(ne).length===0&&!e(B)?h(ge):h(de,!1)},!0)}c(r,n)};u(Je,r=>{e(R)&&e(ne).length===0?r(Me):r(Ye,!1)})}s(me),c(Fe,me),Ve()}export{Ot as component};

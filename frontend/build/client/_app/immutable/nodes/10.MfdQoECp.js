import"../chunks/CWj6FrbW.js";import{o as gt,s as L}from"../chunks/BCkVnCXK.js";import{c as _t,f as Ne,a as p,p as bt,O as v,P as U,Q as mt,i as e,t as w,b as xt,s as a,R as yt,h as s,d as u,$ as ht,n as A,r,g as l,S as wt,T as jt,j as we}from"../chunks/Dwc5JcvW.js";import{i as j}from"../chunks/BGM91MK6.js";import{I as kt,s as $t,a as Oe,r as I,e as J,i as K,c as W}from"../chunks/De-PL9gO.js";import{h as Pt}from"../chunks/--Il8l-M.js";import{b as R,a as Et}from"../chunks/-5BAYQkN.js";import{l as St,s as It,a as Rt,b as Bt}from"../chunks/uIwwuFdP.js";import{p as Mt}from"../chunks/CV6U0ayt.js";import"../chunks/DrRDPxfg.js";import{p as m}from"../chunks/BXxF3ZQE.js";import{A as Tt}from"../chunks/DLRuoQZd.js";import{T as Lt,R as At}from"../chunks/Cj6MAlpo.js";import{T as Ve}from"../chunks/BImVJdth.js";import{L as Dt}from"../chunks/q1IplmyU.js";import"../chunks/CVSZYhH1.js";function Ft(X,C){const Y=St(C,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7"}]];kt(X,It({name:"save"},()=>Y,{get iconNode(){return Z},children:(ee,x)=>{var g=_t(),B=Ne(g);$t(B,C,"default",{}),p(ee,g)},$$slots:{default:!0}}))}var Gt=u('<div class="bg-red-50 border border-red-200 rounded-lg p-4"><p class="text-sm text-red-800"> </p></div>'),qt=u('<div class="bg-green-50 border border-green-200 rounded-lg p-4"><p class="text-sm text-green-800"> </p></div>'),zt=u('<div class="flex items-center justify-center py-12"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div></div>'),Ct=u("<option> </option>"),Ht=u("<option> </option>"),Ot=u('<button class="text-red-600 hover:text-red-700 text-sm"><!></button>'),Vt=u("<option> </option>"),Nt=u('<select id="test-space" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"><option>Select space...</option><!></select>'),Qt=u('<input id="test-space" type="text" placeholder="test" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/>'),Ut=u('<button class="text-red-600 hover:text-red-700 text-sm"><!></button>'),Jt=u("<option> </option>"),Kt=u('<select id="prod-space" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"><option>Select space...</option><!></select>'),Wt=u('<input id="prod-space" type="text" placeholder="default" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/>'),Xt=u('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><h2 class="text-lg font-semibold text-gray-900 mb-4">Project Details</h2> <div class="space-y-4"><div><label for="name" class="block text-sm font-medium text-gray-700 mb-2">Project Name *</label> <input id="name" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/></div> <div><label for="description" class="block text-sm font-medium text-gray-700 mb-2">Description</label> <textarea id="description" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"></textarea></div> <div class="grid grid-cols-2 gap-4"><div><label for="elastic" class="block text-sm font-medium text-gray-700 mb-2">Elastic Instance *</label> <select id="elastic" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"></select></div> <div><label for="git" class="block text-sm font-medium text-gray-700 mb-2">Git Repository *</label> <select id="git" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"></select></div></div> <div><label for="path" class="block text-sm font-medium text-gray-700 mb-2">Base Path in Repository</label> <input id="path" type="text" placeholder="detection-rules/" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/></div> <div class="flex items-center gap-2"><input id="active" type="checkbox" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-600"/> <label for="active" class="text-sm font-medium text-gray-700">Project is active</label></div></div></div> <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="flex items-center justify-between mb-4"><div class="flex items-center gap-3"><div class="p-2 bg-yellow-100 rounded-lg"><!></div> <div><h2 class="text-lg font-semibold text-gray-900">Test Environment</h2> <p class="text-sm text-gray-500">Development and testing configuration</p></div></div> <!></div> <div class="grid grid-cols-2 gap-4"><div><label for="test-space" class="block text-sm font-medium text-gray-700 mb-2">Elastic Space</label> <!></div> <div><label for="test-branch" class="block text-sm font-medium text-gray-700 mb-2">Git Branch</label> <input id="test-branch" type="text" placeholder="develop" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/></div></div></div> <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="flex items-center justify-between mb-4"><div class="flex items-center gap-3"><div class="p-2 bg-green-100 rounded-lg"><!></div> <div><h2 class="text-lg font-semibold text-gray-900">Production Environment</h2> <p class="text-sm text-gray-500">Production configuration (requires MR)</p></div></div> <!></div> <div class="grid grid-cols-2 gap-4"><div><label for="prod-space" class="block text-sm font-medium text-gray-700 mb-2">Elastic Space</label> <!></div> <div><label for="prod-branch" class="block text-sm font-medium text-gray-700 mb-2">Git Branch</label> <input id="prod-branch" type="text" placeholder="main" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/></div></div></div> <div class="flex items-center gap-4"><button class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50"><!> Save Changes</button> <a class="px-6 py-3 text-gray-700 hover:text-gray-900 transition-colors">Cancel</a></div>',1),Yt=u('<div class="max-w-3xl mx-auto space-y-6"><div><a class="inline-flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900 mb-4"><!> Back to Project</a> <h1 class="text-3xl font-bold text-gray-900">Edit Project</h1> <p class="mt-1 text-sm text-gray-500">Update project settings and environment configuration</p></div> <!> <!> <!></div>');function gr(X,C){bt(C,!0);const Y=()=>Bt(Mt,"$page",Z),[Z,ee]=Rt();let x=v(null),g=v(U([])),B=v(U([])),je=v(U([])),D=v(U([])),te=v(!0),H=v(!1),M=v(""),O=v(""),F=v(""),V=v(""),h=v(""),G=v(""),N=v(""),Q=v(!0),b=v(""),k=v(""),y=v(""),$=v(""),P=wt(()=>Y().params.id);gt(async()=>{await re()});async function re(){try{a(te,!0),a(x,await m.collection("projects").getOne(e(P),{expand:"elastic_instance,git_repository"}),!0),a(F,e(x).name,!0),a(V,e(x).description||"",!0),a(h,e(x).elastic_instance,!0),a(G,e(x).git_repository,!0),a(N,e(x).git_path||"",!0),a(Q,e(x).is_active,!0),a(g,await m.collection("environments").getFullList({filter:`project = "${e(P)}"`}),!0);const i=e(g).find(d=>d.name==="test"),n=e(g).find(d=>d.name==="production");i&&(a(b,i.elastic_space,!0),a(k,i.git_branch,!0)),n&&(a(y,n.elastic_space,!0),a($,n.git_branch,!0)),a(B,await m.collection("elastic_instances").getFullList({filter:"is_active = true"}),!0),a(je,await m.collection("git_repositories").getFullList({filter:"is_active = true"}),!0),await ke()}catch(i){a(M,i.message,!0)}finally{a(te,!1)}}async function ke(){if(e(h))try{const i=e(B).find(n=>n.id===e(h));i&&i.spaces&&a(D,i.spaces,!0)}catch(i){console.error("Failed to load spaces:",i)}}mt(()=>{e(h)&&e(B).length>0&&ke()});async function Qe(){try{a(H,!0),a(M,""),a(O,""),await m.collection("projects").update(e(P),{name:e(F),description:e(V)||"",elastic_instance:e(h),elastic_space:e(b),git_repository:e(G),git_path:e(N)||"",is_active:e(Q)});const i=e(g).find(d=>d.name==="test");i?await m.collection("environments").update(i.id,{elastic_space:e(b),git_branch:e(k)}):e(b)&&e(k)&&await m.collection("environments").create({project:e(P),name:"test",elastic_space:e(b),git_branch:e(k),requires_approval:!1,auto_deploy:!0});const n=e(g).find(d=>d.name==="production");n?await m.collection("environments").update(n.id,{elastic_space:e(y),git_branch:e($)}):e(y)&&e($)&&await m.collection("environments").create({project:e(P),name:"production",elastic_space:e(y),git_branch:e($),requires_approval:!0,auto_deploy:!1}),a(O,"Project saved successfully!"),await re()}catch(i){a(M,i.message,!0)}finally{a(H,!1)}}async function $e(i){const n=e(g).find(d=>d.name===i);if(n&&confirm(`Are you sure you want to delete the ${i} environment?`))try{await m.collection("environments").delete(n.id),i==="test"?(a(b,""),a(k,"")):(a(y,""),a($,"")),await re()}catch(d){a(M,d.message,!0)}}var ae=Yt();Pt("1h9ouny",i=>{yt(()=>{var n;ht.title=`Edit ${(((n=e(x))==null?void 0:n.name)||"Project")??""} - Elastic Git Sync`})});var se=s(ae),oe=s(se),Ue=s(oe);Tt(Ue,{class:"w-4 h-4"}),A(),r(oe),A(4),r(se);var Pe=l(se,2);{var Je=i=>{var n=Gt(),d=s(n),T=s(d,!0);r(d),r(n),w(()=>L(T,e(M))),p(i,n)};j(Pe,i=>{e(M)&&i(Je)})}var Ee=l(Pe,2);{var Ke=i=>{var n=qt(),d=s(n),T=s(d,!0);r(d),r(n),w(()=>L(T,e(O))),p(i,n)};j(Ee,i=>{e(O)&&i(Ke)})}var We=l(Ee,2);{var Xe=i=>{var n=zt();p(i,n)},Ye=i=>{var n=Xt(),d=Ne(n),T=l(s(d),2),ie=s(T),Se=l(s(ie),2);I(Se),r(ie);var le=l(ie,2),Ie=l(s(le),2);jt(Ie),r(le);var ne=l(le,2),ce=s(ne),de=l(s(ce),2);J(de,21,()=>e(B),K,(t,o)=>{var c=Ct(),E=s(c,!0);r(c);var f={};w(()=>{L(E,e(o).name),f!==(f=e(o).id)&&(c.value=(c.__value=e(o).id)??"")}),p(t,c)}),r(de),r(ce);var Re=l(ce,2),ve=l(s(Re),2);J(ve,21,()=>e(je),K,(t,o)=>{var c=Ht(),E=s(c,!0);r(c);var f={};w(()=>{L(E,e(o).name),f!==(f=e(o).id)&&(c.value=(c.__value=e(o).id)??"")}),p(t,c)}),r(ve),r(Re),r(ne);var pe=l(ne,2),Be=l(s(pe),2);I(Be),r(pe);var Me=l(pe,2),Te=s(Me);I(Te),A(2),r(Me),r(T),r(d);var ue=l(d,2),fe=s(ue),ge=s(fe),Le=s(ge),Ze=s(Le);Lt(Ze,{class:"w-5 h-5 text-yellow-600"}),r(Le),A(2),r(ge);var et=l(ge,2);{var tt=t=>{var o=Ot(),c=s(o);Ve(c,{class:"w-4 h-4"}),r(o),we("click",o,()=>$e("test")),p(t,o)};j(et,t=>{e(g).find(o=>o.name==="test")&&t(tt)})}r(fe);var Ae=l(fe,2),_e=s(Ae),rt=l(s(_e),2);{var at=t=>{var o=Nt(),c=s(o);c.value=c.__value="";var E=l(c);J(E,17,()=>e(D),K,(f,S)=>{var _=Vt(),he=s(_,!0);r(_);var z={};w(()=>{L(he,e(S)),z!==(z=e(S))&&(_.value=(_.__value=e(S))??"")}),p(f,_)}),r(o),W(o,()=>e(b),f=>a(b,f)),p(t,o)},st=t=>{var o=Qt();I(o),R(o,()=>e(b),c=>a(b,c)),p(t,o)};j(rt,t=>{e(D).length>0?t(at):t(st,!1)})}r(_e);var De=l(_e,2),Fe=l(s(De),2);I(Fe),r(De),r(Ae),r(ue);var be=l(ue,2),me=s(be),xe=s(me),Ge=s(xe),ot=s(Ge);At(ot,{class:"w-5 h-5 text-green-600"}),r(Ge),A(2),r(xe);var it=l(xe,2);{var lt=t=>{var o=Ut(),c=s(o);Ve(c,{class:"w-4 h-4"}),r(o),we("click",o,()=>$e("production")),p(t,o)};j(it,t=>{e(g).find(o=>o.name==="production")&&t(lt)})}r(me);var qe=l(me,2),ye=s(qe),nt=l(s(ye),2);{var ct=t=>{var o=Kt(),c=s(o);c.value=c.__value="";var E=l(c);J(E,17,()=>e(D),K,(f,S)=>{var _=Jt(),he=s(_,!0);r(_);var z={};w(()=>{L(he,e(S)),z!==(z=e(S))&&(_.value=(_.__value=e(S))??"")}),p(f,_)}),r(o),W(o,()=>e(y),f=>a(y,f)),p(t,o)},dt=t=>{var o=Wt();I(o),R(o,()=>e(y),c=>a(y,c)),p(t,o)};j(nt,t=>{e(D).length>0?t(ct):t(dt,!1)})}r(ye);var ze=l(ye,2),Ce=l(s(ze),2);I(Ce),r(ze),r(qe),r(be);var He=l(be,2),q=s(He),vt=s(q);{var pt=t=>{Dt(t,{class:"w-5 h-5 animate-spin"})},ut=t=>{Ft(t,{class:"w-5 h-5"})};j(vt,t=>{e(H)?t(pt):t(ut,!1)})}A(),r(q);var ft=l(q,2);r(He),w(()=>{q.disabled=e(H)||!e(F)||!e(h)||!e(G),Oe(ft,"href",`/projects/${e(P)??""}`)}),R(Se,()=>e(F),t=>a(F,t)),R(Ie,()=>e(V),t=>a(V,t)),W(de,()=>e(h),t=>a(h,t)),W(ve,()=>e(G),t=>a(G,t)),R(Be,()=>e(N),t=>a(N,t)),Et(Te,()=>e(Q),t=>a(Q,t)),R(Fe,()=>e(k),t=>a(k,t)),R(Ce,()=>e($),t=>a($,t)),we("click",q,Qe),p(i,n)};j(We,i=>{e(te)?i(Xe):i(Ye,!1)})}r(ae),w(()=>Oe(oe,"href",`/projects/${e(P)??""}`)),p(X,ae),xt(),ee()}export{gr as component};

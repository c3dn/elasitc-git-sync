import"../chunks/CWj6FrbW.js";import{i as We}from"../chunks/Dl2LfGm4.js";import{o as Xe,s as y}from"../chunks/O7RWNxBF.js";import{p as Ze,a as l,b as $e,e as er,d as x,s as a,$ as rr,h as i,i as e,g as o,r as s,m as c,n as C,j as E,t as M,q as tr,c as Ce,f as Re,o as ie}from"../chunks/C9NYA0Nw.js";import{i as g}from"../chunks/D2ldot_M.js";import{r as z,c as ar,d as sr,e as ir,a as or,i as nr}from"../chunks/z_jCEgha.js";import{h as lr}from"../chunks/k5AYXn5z.js";import{b as oe,a as dr}from"../chunks/DkcqxK1V.js";import{a as Se,p as R}from"../chunks/BUCyip3L.js";import{P as cr}from"../chunks/B790a_s2.js";import{L as Le}from"../chunks/Bo3rhy3K.js";import{R as De,P as vr}from"../chunks/B3KBZgIT.js";import{T as gr}from"../chunks/Dr9VXG2L.js";import{C as pr}from"../chunks/BF4Or9KR.js";import{C as ur}from"../chunks/D3EV4tGk.js";var br=x('<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4"><p class="text-sm text-yellow-800 font-medium">SSL certificate verification is disabled</p> <p class="text-xs text-yellow-700 mt-1">The DISABLE_SSL_VERIFY environment variable is set to true. All outgoing HTTPS connections skip certificate verification.</p></div>'),yr=x('<button class="inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors"><!> Add Git Repository</button>'),fr=x('<div class="mb-4 bg-red-50 border border-red-200 rounded-lg p-4"><p class="text-sm text-red-800"> </p></div>'),mr=x('<div class="bg-white dark:bg-gray-900 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"><h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4"> </h3> <!> <div class="space-y-4"><div><label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Repository Name *</label> <input id="name" type="text" placeholder="Security Rules Repository" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"/></div> <div><label for="provider" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Provider *</label> <select id="provider" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent appearance-auto"><option>GitLab</option><option>GitHub</option><option>Generic Git</option></select></div> <div><label for="url" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Repository URL *</label> <input id="url" type="url" placeholder="https://gitlab.com/your-org/security-rules" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"/> <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Full HTTPS URL to your Git repository</p></div> <div><label for="token" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"> </label> <input id="token" type="password" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"/> <p class="text-xs text-gray-500 dark:text-gray-400 mt-1"><!></p></div> <div><label for="branch" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Default Branch *</label> <input id="branch" type="text" placeholder="main" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"/></div> <div><label for="base-path" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Base Path (optional)</label> <input id="base-path" type="text" placeholder="rules/" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"/> <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Default subdirectory for storing rules</p></div> <div class="flex items-center gap-2"><input id="is-active" type="checkbox" class="w-4 h-4 text-primary-600 border-gray-300 dark:border-gray-600 rounded focus:ring-primary-600"/> <label for="is-active" class="text-sm font-medium text-gray-700 dark:text-gray-300">Active</label></div> <div class="flex items-center gap-3 pt-4"><button class="inline-flex items-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"><!> Test Connection</button> <button class="inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"><!></button> <button class="px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100 transition-colors">Cancel</button></div></div></div>'),xr=x('<div class="flex items-center justify-center py-12"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"></div></div>'),_r=x('<div class="bg-white dark:bg-gray-900 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-12 text-center"><p class="text-gray-500 dark:text-gray-400">No Git repositories configured yet.</p></div>'),hr=x('<div class="bg-white dark:bg-gray-900 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"><div class="flex items-start justify-between"><div class="flex-1"><div class="flex items-center gap-3 mb-2"><h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100"> </h3> <!> <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200"> </span></div> <p class="text-sm text-gray-600 dark:text-gray-400 mb-1"> </p> <p class="text-xs text-gray-500 dark:text-gray-400"> <!></p></div> <div class="flex items-center gap-2"><span> </span></div></div> <div class="flex items-center gap-2 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700"><button class="inline-flex items-center gap-2 px-3 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors text-sm"><!> Test Connection</button> <button class="inline-flex items-center gap-2 px-3 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors text-sm"><!> Edit</button> <button class="ml-auto inline-flex items-center gap-2 px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors text-sm"><!> Delete</button></div></div>'),kr=x('<div class="space-y-4"></div>'),wr=x('<div class="space-y-6"><!> <!> <!> <!></div>');function Or(Ee,Ie){Ze(Ie,!1);let ne=c([]),I=c(!1),S=c(!1),le=c(!1),b=c(""),f=c(null),Te=c(!1),U=c(""),_=c(""),m=c("gitlab"),h=c(""),B=c("main"),K=c(""),Q=c(!0);Xe(async()=>{await de();try{const n=await(await Se(`${R.baseUrl}/api/settings/ssl-status`)).json();a(Te,n.ssl_verification_disabled)}catch{}});async function de(){try{a(S,!0),a(ne,await R.collection("git_repositories").getFullList({sort:"-created"}))}catch(r){a(b,r.message)}finally{a(S,!1)}}function Pe(){a(U,""),a(_,""),a(m,"gitlab"),a(h,""),a(B,"main"),a(K,""),a(Q,!0),a(f,null),a(b,"")}function Ue(){Pe(),a(I,!0)}function Be(r){a(f,r.id),a(U,r.name),a(_,r.url),a(m,r.provider),a(h,r.access_token),a(B,r.default_branch),a(K,r.base_path||""),a(Q,r.is_active),a(b,""),a(I,!0)}function Ge(){a(I,!1),Pe()}async function Oe(){var r;try{a(le,!0),a(b,"");const v=await(await Se(`${R.baseUrl}/api/connection/test`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"git",config:{url:e(_),provider:e(m),access_token:e(h)}})})).json();v.success?alert(`Connection successful! Found ${((r=v.branches)==null?void 0:r.length)||0} branches.`):a(b,v.message)}catch(n){a(b,n.message)}finally{a(le,!1)}}async function Ne(){try{a(S,!0),a(b,"");const r={name:e(U),url:e(_),provider:e(m),access_token:e(h),default_branch:e(B),base_path:e(K)||"",is_active:e(Q)};e(f)?await R.collection("git_repositories").update(e(f),r):await R.collection("git_repositories").create(r),Ge(),await de()}catch(r){a(b,r.message)}finally{a(S,!1)}}async function He(r){if(confirm("Are you sure you want to delete this repository?"))try{await R.collection("git_repositories").delete(r),await de()}catch(n){alert(`Error: ${n.message}`)}}async function Je(r){try{const v=await(await Se(`${R.baseUrl}/api/connection/test`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"git",config:{url:r.url,provider:r.provider,access_token:r.access_token}})})).json();await R.collection("git_repositories").update(r.id,{connection_status:v.success?"success":"failed",last_connection_test:new Date().toISOString()}),await de()}catch(n){console.error("Connection test failed:",n)}}We();var ye=wr();lr("xtvn8n",r=>{er(()=>{rr.title="Git Repositories - Settings"})});var Ae=i(ye);{var Ve=r=>{var n=br();l(r,n)};g(Ae,r=>{e(Te)&&r(Ve)})}var Fe=o(Ae,2);{var Ye=r=>{var n=yr(),v=i(n);cr(v,{class:"w-5 h-5"}),C(),s(n),E("click",n,Ue),l(r,n)};g(Fe,r=>{e(I)||r(Ye)})}var je=o(Fe,2);{var qe=r=>{var n=mr(),v=i(n),fe=i(v,!0);s(v);var ce=o(v,2);{var k=t=>{var u=fr(),be=i(u),ke=i(be,!0);s(be),s(u),M(()=>y(ke,e(b))),l(t,u)};g(ce,t=>{e(b)&&t(k)})}var w=o(ce,2),W=i(w),d=o(i(W),2);z(d),s(W);var T=o(W,2),P=o(i(T),2);M(()=>{e(m),tr(()=>{})});var G=i(P);G.value=G.__value="gitlab";var A=o(G);A.value=A.__value="github";var O=o(A);O.value=O.__value="generic",s(P),s(T);var X=o(T,2),Z=o(i(X),2);z(Z),C(2),s(X);var $=o(X,2),ee=i($),ve=i(ee);s(ee);var N=o(ee,2);z(N);var H=o(N,2),me=i(H);{var ge=t=>{var u=ie("Create a project access token with API and write_repository scopes");l(t,u)},pe=t=>{var u=Ce(),be=Re(u);{var ke=q=>{var we=ie("Create a personal access token with repo scope");l(q,we)},Qe=q=>{var we=ie("Token for authentication");l(q,we)};g(be,q=>{e(m)==="github"?q(ke):q(Qe,!1)},!0)}l(t,u)};g(me,t=>{e(m)==="gitlab"?t(ge):t(pe,!1)})}s(H),s($);var re=o($,2),ue=o(i(re),2);z(ue),s(re);var J=o(re,2),V=o(i(J),2);z(V),C(2),s(J);var te=o(J,2),ae=i(te);z(ae),C(2),s(te);var F=o(te,2),j=i(F),Y=i(j);{var xe=t=>{Le(t,{class:"w-4 h-4 animate-spin"})},se=t=>{De(t,{class:"w-4 h-4"})};g(Y,t=>{e(le)?t(xe):t(se,!1)})}C(),s(j);var L=o(j,2),p=i(L);{var D=t=>{Le(t,{class:"w-4 h-4 animate-spin"})},_e=t=>{var u=ie();M(()=>y(u,e(f)?"Update":"Save")),l(t,u)};g(p,t=>{e(S)?t(D):t(_e,!1)})}s(L);var he=o(L,2);s(F),s(w),s(n),M(()=>{y(fe,e(f)?"Edit Git Repository":"Add Git Repository"),y(ve,`Access Token ${e(f)?"(leave empty to keep current)":"*"}`),ar(N,"placeholder",e(f)?"••••••••":"Your Git access token"),j.disabled=!e(_)||!e(h)||e(le),L.disabled=e(S)||!e(U)||!e(_)||!e(f)&&!e(h)||!e(B)}),oe(d,()=>e(U),t=>a(U,t)),sr(P,()=>e(m),t=>a(m,t)),oe(Z,()=>e(_),t=>a(_,t)),oe(N,()=>e(h),t=>a(h,t)),oe(ue,()=>e(B),t=>a(B,t)),oe(V,()=>e(K),t=>a(K,t)),dr(ae,()=>e(Q),t=>a(Q,t)),E("click",j,Oe),E("click",L,Ne),E("click",he,Ge),l(r,n)};g(je,r=>{e(I)&&r(qe)})}var Me=o(je,2);{var ze=r=>{var n=xr();l(r,n)},Ke=r=>{var n=Ce(),v=Re(n);{var fe=k=>{var w=_r();l(k,w)},ce=k=>{var w=kr();ir(w,5,()=>e(ne),nr,(W,d)=>{var T=hr(),P=i(T),G=i(P),A=i(G),O=i(A),X=i(O,!0);s(O);var Z=o(O,2);{var $=p=>{pr(p,{class:"w-5 h-5 text-green-600"})},ee=p=>{var D=Ce(),_e=Re(D);{var he=t=>{ur(t,{class:"w-5 h-5 text-red-600"})};g(_e,t=>{e(d).connection_status==="failed"&&t(he)},!0)}l(p,D)};g(Z,p=>{e(d).connection_status==="success"?p($):p(ee,!1)})}var ve=o(Z,2),N=i(ve,!0);s(ve),s(A);var H=o(A,2),me=i(H,!0);s(H);var ge=o(H,2),pe=i(ge),re=o(pe);{var ue=p=>{var D=ie();M(()=>y(D,`• Path: ${e(d).base_path??""}`)),l(p,D)};g(re,p=>{e(d).base_path&&p(ue)})}s(ge),s(G);var J=o(G,2),V=i(J),te=i(V,!0);s(V),s(J),s(P);var ae=o(P,2),F=i(ae),j=i(F);De(j,{class:"w-4 h-4"}),C(),s(F);var Y=o(F,2),xe=i(Y);vr(xe,{class:"w-4 h-4"}),C(),s(Y);var se=o(Y,2),L=i(se);gr(L,{class:"w-4 h-4"}),C(),s(se),s(ae),s(T),M(()=>{y(X,e(d).name),y(N,e(d).provider),y(me,e(d).url),y(pe,`Branch: ${e(d).default_branch??""} `),or(V,1,`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
								${e(d).is_active?"bg-green-100 text-green-800":"bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200"}`),y(te,e(d).is_active?"Active":"Inactive")}),E("click",F,()=>Je(e(d))),E("click",Y,()=>Be(e(d))),E("click",se,()=>He(e(d).id)),l(W,T)}),s(w),l(k,w)};g(v,k=>{e(ne).length===0&&!e(I)?k(fe):k(ce,!1)},!0)}l(r,n)};g(Me,r=>{e(S)&&e(ne).length===0?r(ze):r(Ke,!1)})}s(ye),l(Ee,ye),$e()}export{Or as component};

import"../chunks/CWj6FrbW.js";import{o as rr,s as N}from"../chunks/O7RWNxBF.js";import{c as tr,f as ve,a as i,p as ar,l as P,R as _e,S as Ie,i as e,s as p,t as R,j as re,b as or,e as sr,h as t,d,U as H,$ as lr,n as T,r,g as a,W as Be,V as ir}from"../chunks/C9NYA0Nw.js";import{i as G}from"../chunks/D2ldot_M.js";import{I as dr,s as nr,e as te,i as ae,a as oe,r as J,c as ce}from"../chunks/rMS1oNTx.js";import{h as cr}from"../chunks/k5AYXn5z.js";import{b as W}from"../chunks/DkcqxK1V.js";import{g as vr}from"../chunks/--SkU8XW.js";import{p as se}from"../chunks/BUCyip3L.js";import{A as Ne}from"../chunks/NOXAU2LB.js";import"../chunks/Dl2LfGm4.js";import{l as pr,s as gr}from"../chunks/Cs0PMOxO.js";import{T as ur}from"../chunks/ChWmmJ1c.js";import{R as br}from"../chunks/Cx4sQyjC.js";import{A as yr}from"../chunks/BdwfjclZ.js";function Ae(pe,le){const g=pr(le,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=[["path",{d:"M20 6 9 17l-5-5"}]];dr(pe,gr({name:"check"},()=>g,{get iconNode(){return C},children:(q,me)=>{var F=tr(),K=ve(F);nr(K,le,"default",{}),i(q,F)},$$slots:{default:!0}}))}var xr=d('<span class="text-sm font-semibold"></span>'),fr=d("<div></div>"),_r=d('<div class="flex items-center flex-1"><div class="flex flex-col items-center"><div><!></div> <span> </span></div> <!></div>'),mr=d('<div class="mb-6 bg-red-50 border border-red-200 rounded-lg p-4"><p class="text-sm text-red-800"> </p></div>'),hr=d('<div class="space-y-4"><h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Basic Information</h2> <div><label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Project Name *</label> <input id="name" type="text" placeholder="My Security Rules Project" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/></div> <div><label for="description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description (optional)</label> <textarea id="description" placeholder="Describe this project..." rows="3" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"></textarea></div> <div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Sync Mode *</label> <div class="grid grid-cols-2 gap-3"><button type="button"><span class="text-sm font-semibold text-gray-900 dark:text-gray-100">Full Workflow</span> <span class="text-xs text-gray-500 dark:text-gray-400 mt-1 text-left">Export to Git, create merge requests, and import to production</span></button> <button type="button"><span class="text-sm font-semibold text-gray-900 dark:text-gray-100">Export Only</span> <span class="text-xs text-gray-500 dark:text-gray-400 mt-1 text-left">Only export rules from Elastic to Git (one-way sync)</span></button></div></div></div>'),kr=d('<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4"><p class="text-sm text-yellow-800">No Elastic instances configured. Please add one in settings first.</p> <a href="/settings/elastic" class="text-sm text-blue-600 hover:underline mt-2 inline-block">Add Elastic Instance</a></div>'),wr=d("<option> </option>"),Pr=d('<div><label for="elastic-instance" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Elastic Instance *</label> <select id="elastic-instance" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"><option>Select instance...</option><!></select></div>'),jr=d('<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4"><p class="text-sm text-yellow-800">No Git repositories configured. Please add one in settings first.</p> <a href="/settings/git" class="text-sm text-blue-600 hover:underline mt-2 inline-block">Add Git Repository</a></div>'),Sr=d("<option> </option>"),Er=d('<div><label for="git-repo" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Git Repository *</label> <select id="git-repo" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"><option>Select repository...</option><!></select></div> <div><label for="git-path" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Base Path in Repository (optional)</label> <input id="git-path" type="text" placeholder="detection-rules/" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/> <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Base directory for rules. Environments will have subdirectories.</p></div>',1),Rr=d('<div class="space-y-4"><h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Connections</h2> <p class="text-sm text-gray-500 dark:text-gray-400">Select the Elastic instance and Git repository for this project.</p> <!> <!></div>'),Cr=d("Rules will be exported from this Elastic space to the <strong> </strong> branch in Git.",1),Gr=d(`Rules synced here will be saved to the <strong> </strong> branch.
							Use this for testing new rules before promoting to production.`,1),Ir=d("<option> </option>"),Br=d('<select id="test-space" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"><option>Select space...</option><!></select>'),Nr=d('<input id="test-space" type="text" placeholder="test" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/>'),Ar=d('<div class="space-y-4"><div class="flex items-center gap-3"><div class="p-2 bg-yellow-100 rounded-lg"><!></div> <div><h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100"> </h2> <p class="text-sm text-gray-500 dark:text-gray-400"> </p></div></div> <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4"><p class="text-sm text-yellow-800"><!></p></div> <div><label for="test-space" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Elastic Space (Test) *</label> <!></div> <div><label for="test-branch" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Git Branch (Test) *</label> <input id="test-branch" type="text" placeholder="develop" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/> <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Branch where test rules will be synced (e.g., develop, staging)</p></div></div>'),Tr=d("<option> </option>"),Mr=d('<select id="prod-space" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"><option>Select space...</option><!></select>'),qr=d('<input id="prod-space" type="text" placeholder="default" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/>'),Fr=d(`<div class="space-y-4"><div class="flex items-center gap-3"><div class="p-2 bg-green-100 rounded-lg"><!></div> <div><h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Production Environment</h2> <p class="text-sm text-gray-500 dark:text-gray-400">Configure the production environment</p></div></div> <div class="bg-green-50 border border-green-200 rounded-lg p-4"><p class="text-sm text-green-800">Rules synced here will be saved to the <strong> </strong> branch.
						Changes require a Merge Request from <strong> </strong>.</p></div> <div><label for="prod-space" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Elastic Space (Production) *</label> <!></div> <div><label for="prod-branch" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Git Branch (Production) *</label> <input id="prod-branch" type="text" placeholder="main" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/> <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Protected branch for production rules (e.g., main, master)</p></div></div>`),Dr=d('<button class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">Next <!></button>'),Or=d('<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>'),$r=d('<button class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"><!> Create Project</button>'),Lr=d('<div class="max-w-3xl mx-auto space-y-6"><div><a href="/projects" class="inline-flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 mb-4"><!> Back to Projects</a> <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100">Create New Project</h1> <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Configure Test and Production environments for your detection rules</p></div> <div class="bg-white dark:bg-gray-900 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"><div class="flex items-center justify-between mb-8"></div> <!> <!> <!> <!> <!> <div class="flex items-center justify-between mt-8 pt-6 border-t border-gray-200 dark:border-gray-700"><button class="inline-flex items-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"><!> Previous</button> <!></div></div></div>');function ot(pe,le){ar(le,!0);let g=P(1),C=P("full"),q=H(()=>e(C)==="export_only"?3:4),me=H(()=>e(C)==="export_only"?["Project Info","Connections","Environment"]:["Project Info","Connections","Test Environment","Prod Environment"]),F=P(""),K=P(""),D=P(""),ie=P(""),ge=P(""),O=P(""),$=P("develop"),z=P(""),Q=P("main"),de=P(_e([])),ue=P(_e([])),X=P(_e([])),ne=P(!1),Y=P(""),Te=H(()=>e(F).trim().length>0),Me=H(()=>e(D)!==""&&e(ie)!==""),qe=H(()=>e(O)!==""&&e($).trim().length>0),Fe=H(()=>e(z)!==""&&e(Q).trim().length>0);rr(async()=>{await De()});async function De(){try{p(de,await se.collection("elastic_instances").getFullList({filter:"is_active = true"}),!0),p(ue,await se.collection("git_repositories").getFullList({filter:"is_active = true"}),!0)}catch(o){p(Y,o.message,!0)}}async function Oe(){if(e(D))try{const o=e(de).find(s=>s.id===e(D));o&&o.spaces&&p(X,o.spaces,!0)}catch(o){console.error("Failed to load spaces:",o)}}Ie(()=>{e(D)&&Oe()}),Ie(()=>{e(g)>e(q)&&p(g,e(q),!0)});function $e(){e(g)<e(q)&&Be(g)}function Le(){e(g)>1&&Be(g,-1)}async function Ue(){try{p(ne,!0),p(Y,"");const o={name:e(F),description:e(K),elastic_instance:e(D),elastic_space:e(O),git_repository:e(ie),git_path:e(ge)||void 0,is_active:!0,sync_enabled:!0,sync_mode:e(C)},s=await se.collection("projects").create(o);await se.collection("environments").create({project:s.id,name:"test",elastic_space:e(O),git_branch:e($),requires_approval:!1,auto_deploy:!0}),e(C)==="full"&&await se.collection("environments").create({project:s.id,name:"production",elastic_space:e(z),git_branch:e(Q),requires_approval:!0,auto_deploy:!1}),vr("/projects/"+s.id)}catch(o){p(Y,o.message,!0)}finally{p(ne,!1)}}function he(o){switch(o){case 1:return e(Te);case 2:return e(Me);case 3:return e(qe);case 4:return e(Fe);default:return!1}}var be=Lr();cr("1ytgd2c",o=>{sr(()=>{lr.title="New Project - Elastic Git Sync"})});var ye=t(be),ke=t(ye),We=t(ke);Ne(We,{class:"w-4 h-4"}),T(),r(ke),T(4),r(ye);var we=a(ye,2),xe=t(we);te(xe,21,()=>Array(e(q)),ae,(o,s,l)=>{var u=_r(),j=t(u),n=t(j),S=t(n);{var I=b=>{Ae(b,{class:"w-5 h-5 text-white"})},c=b=>{var k=xr();k.textContent=l+1,i(b,k)};G(S,b=>{e(g)>l+1?b(I):b(c,!1)})}r(n);var v=a(n,2),y=t(v,!0);r(v),r(j);var h=a(j,2);{var A=b=>{var k=fr();R(()=>oe(k,1,`flex-1 h-1 mx-4 rounded -mt-6
							${e(g)>l+1?"bg-blue-600":"bg-gray-200 dark:bg-gray-700"}`)),i(b,k)};G(h,b=>{l<e(q)-1&&b(A)})}r(u),R(()=>{oe(n,1,`flex items-center justify-center w-10 h-10 rounded-full border-2 transition-colors
							${e(g)>l+1?"bg-blue-600 border-blue-600":e(g)===l+1?"border-blue-600 text-blue-600":"border-gray-300 dark:border-gray-600 text-gray-400 dark:text-gray-500"}`),oe(v,1,`mt-2 text-xs font-medium text-center ${e(g)>=l+1?"text-blue-600":"text-gray-400 dark:text-gray-500"}`),N(y,e(me)[l])}),i(o,u)}),r(xe);var Pe=a(xe,2);{var ze=o=>{var s=mr(),l=t(s),u=t(l,!0);r(l),r(s),R(()=>N(u,e(Y))),i(o,s)};G(Pe,o=>{e(Y)&&o(ze)})}var je=a(Pe,2);{var Ve=o=>{var s=hr(),l=a(t(s),2),u=a(t(l),2);J(u),r(l);var j=a(l,2),n=a(t(j),2);ir(n),r(j);var S=a(j,2),I=a(t(S),2),c=t(I),v=a(c,2);r(I),r(S),r(s),R(()=>{oe(c,1,`flex flex-col items-start p-4 border-2 rounded-lg transition-colors
								${e(C)==="full"?"border-blue-600 bg-blue-50":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`),oe(v,1,`flex flex-col items-start p-4 border-2 rounded-lg transition-colors
								${e(C)==="export_only"?"border-blue-600 bg-blue-50":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`)}),W(u,()=>e(F),y=>p(F,y)),W(n,()=>e(K),y=>p(K,y)),re("click",c,()=>p(C,"full")),re("click",v,()=>p(C,"export_only")),i(o,s)};G(je,o=>{e(g)===1&&o(Ve)})}var Se=a(je,2);{var He=o=>{var s=Rr(),l=a(t(s),4);{var u=c=>{var v=kr();i(c,v)},j=c=>{var v=Pr(),y=a(t(v),2),h=t(y);h.value=h.__value="";var A=a(h);te(A,17,()=>e(de),ae,(b,k)=>{var E=wr(),B=t(E,!0);r(E);var _={};R(()=>{N(B,e(k).name),_!==(_=e(k).id)&&(E.value=(E.__value=e(k).id)??"")}),i(b,E)}),r(y),r(v),ce(y,()=>e(D),b=>p(D,b)),i(c,v)};G(l,c=>{e(de).length===0?c(u):c(j,!1)})}var n=a(l,2);{var S=c=>{var v=jr();i(c,v)},I=c=>{var v=Er(),y=ve(v),h=a(t(y),2),A=t(h);A.value=A.__value="";var b=a(A);te(b,17,()=>e(ue),ae,(B,_)=>{var w=Sr(),M=t(w,!0);r(w);var L={};R(()=>{N(M,e(_).name),L!==(L=e(_).id)&&(w.value=(w.__value=e(_).id)??"")}),i(B,w)}),r(h),r(y);var k=a(y,2),E=a(t(k),2);J(E),T(2),r(k),ce(h,()=>e(ie),B=>p(ie,B)),W(E,()=>e(ge),B=>p(ge,B)),i(c,v)};G(n,c=>{e(ue).length===0?c(S):c(I,!1)})}r(s),i(o,s)};G(Se,o=>{e(g)===2&&o(He)})}var Ee=a(Se,2);{var Je=o=>{var s=Ar(),l=t(s),u=t(l),j=t(u);ur(j,{class:"w-6 h-6 text-yellow-600"}),r(u);var n=a(u,2),S=t(n),I=t(S,!0);r(S);var c=a(S,2),v=t(c,!0);r(c),r(n),r(l);var y=a(l,2),h=t(y),A=t(h);{var b=x=>{var f=Cr(),m=a(ve(f)),U=t(m,!0);r(m),T(),R(()=>N(U,e($)||"develop")),i(x,f)},k=x=>{var f=Gr(),m=a(ve(f)),U=t(m,!0);r(m),T(),R(()=>N(U,e($)||"develop")),i(x,f)};G(A,x=>{e(C)==="export_only"?x(b):x(k,!1)})}r(h),r(y);var E=a(y,2),B=a(t(E),2);{var _=x=>{var f=Br(),m=t(f);m.value=m.__value="";var U=a(m);te(U,17,()=>e(X),ae,(V,fe)=>{var ee=Ir(),er=t(ee,!0);r(ee);var Ge={};R(()=>{N(er,e(fe)),Ge!==(Ge=e(fe))&&(ee.value=(ee.__value=e(fe))??"")}),i(V,ee)}),r(f),ce(f,()=>e(O),V=>p(O,V)),i(x,f)},w=x=>{var f=Nr();J(f),W(f,()=>e(O),m=>p(O,m)),i(x,f)};G(B,x=>{e(X).length>0?x(_):x(w,!1)})}r(E);var M=a(E,2),L=a(t(M),2);J(L),T(2),r(M),r(s),R(()=>{N(I,e(C)==="export_only"?"Environment":"Test Environment"),N(v,e(C)==="export_only"?"Configure the Elastic space and Git branch for exporting rules":"Configure the development/test environment")}),W(L,()=>e($),x=>p($,x)),i(o,s)};G(Ee,o=>{e(g)===3&&o(Je)})}var Re=a(Ee,2);{var Ke=o=>{var s=Fr(),l=t(s),u=t(l),j=t(u);br(j,{class:"w-6 h-6 text-green-600"}),r(u),T(2),r(l);var n=a(l,2),S=t(n),I=a(t(S)),c=t(I,!0);r(I);var v=a(I,2),y=t(v,!0);r(v),T(),r(S),r(n);var h=a(n,2),A=a(t(h),2);{var b=_=>{var w=Mr(),M=t(w);M.value=M.__value="";var L=a(M);te(L,17,()=>e(X),ae,(x,f)=>{var m=Tr(),U=t(m,!0);r(m);var V={};R(()=>{N(U,e(f)),V!==(V=e(f))&&(m.value=(m.__value=e(f))??"")}),i(x,m)}),r(w),ce(w,()=>e(z),x=>p(z,x)),i(_,w)},k=_=>{var w=qr();J(w),W(w,()=>e(z),M=>p(z,M)),i(_,w)};G(A,_=>{e(X).length>0?_(b):_(k,!1)})}r(h);var E=a(h,2),B=a(t(E),2);J(B),T(2),r(E),r(s),R(()=>{N(c,e(Q)||"main"),N(y,e($)||"develop")}),W(B,()=>e(Q),_=>p(Q,_)),i(o,s)};G(Re,o=>{e(g)===4&&e(C)==="full"&&o(Ke)})}var Ce=a(Re,2),Z=t(Ce),Qe=t(Z);Ne(Qe,{class:"w-4 h-4"}),T(),r(Z);var Xe=a(Z,2);{var Ye=o=>{var s=Dr(),l=a(t(s));yr(l,{class:"w-4 h-4"}),r(s),R(u=>s.disabled=u,[()=>!he(e(g))]),re("click",s,$e),i(o,s)},Ze=o=>{var s=$r(),l=t(s);{var u=n=>{var S=Or();i(n,S)},j=n=>{Ae(n,{class:"w-4 h-4"})};G(l,n=>{e(ne)?n(u):n(j,!1)})}T(),r(s),R(n=>s.disabled=n,[()=>e(ne)||!he(e(g))]),re("click",s,Ue),i(o,s)};G(Xe,o=>{e(g)<e(q)?o(Ye):o(Ze,!1)})}r(Ce),r(we),r(be),R(()=>Z.disabled=e(g)===1),re("click",Z,Le),i(pe,be),or()}export{ot as component};

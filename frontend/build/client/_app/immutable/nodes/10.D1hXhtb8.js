import"../chunks/CWj6FrbW.js";import{o as Ot,s as I}from"../chunks/BnHnlVXU.js";import{c as Vt,f as Ce,a as u,p as zt,k as c,R as ie,S as Ht,i as e,t as G,b as Ut,s as a,T as Wt,h as r,d as p,$ as Nt,n as M,r as t,g as o,U as Jt,V as Kt,j as Q}from"../chunks/BbuzmxRY.js";import{i as w}from"../chunks/XgF_cVEg.js";import{I as Qt,s as Xt,a as ut,r as R,e as le,i as ne,b as pt,c as X}from"../chunks/Bm_MFDQ1.js";import{h as Yt}from"../chunks/BwaF3Q6U.js";import{b as C,a as bt}from"../chunks/BjJ5yzjH.js";import{l as Zt,s as er,a as tr,b as rr}from"../chunks/cVoOpi3M.js";import{p as ar}from"../chunks/C4oicLII.js";import"../chunks/Cak3-npf.js";import{p as E}from"../chunks/BVZH3wAp.js";import{A as or}from"../chunks/3e7qVaIY.js";import{C as sr}from"../chunks/Dp_7Pi6Y.js";import{T as ir,R as lr}from"../chunks/BB-mXNPS.js";import{T as _t}from"../chunks/-YWqKXAd.js";import{L as nr}from"../chunks/Cr7rThFx.js";import"../chunks/COK2pY8o.js";function dr(de,Y){const ce=Zt(Y,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7"}]];Qt(de,er({name:"save"},()=>ce,{get iconNode(){return ve},children:(ue,g)=>{var x=Vt(),D=Ce(x);Xt(D,Y,"default",{}),u(ue,x)},$$slots:{default:!0}}))}var cr=p('<div class="bg-red-50 border border-red-200 rounded-lg p-4"><p class="text-sm text-red-800"> </p></div>'),vr=p('<div class="bg-green-50 border border-green-200 rounded-lg p-4"><p class="text-sm text-green-800"> </p></div>'),ur=p('<div class="flex items-center justify-center py-12"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div></div>'),pr=p("<option> </option>"),br=p("<option> </option>"),_r=p(`<div><label for="sync-interval" class="block text-sm font-medium text-gray-700 mb-2">Sync Interval</label> <select id="sync-interval" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"><option>Every 5 minutes</option><option>Every 15 minutes</option><option>Every 30 minutes</option><option>Every hour</option><option>Every 2 hours</option><option>Every 6 hours</option><option>Every 12 hours</option><option>Every 24 hours</option></select></div> <div class="bg-blue-50 border border-blue-200 rounded-lg p-3"><p class="text-sm text-blue-800">When enabled, rules from your Test environment will be automatically exported to Git at the selected interval.
							This only exports from Elastic to Git - it does not import rules to Production.</p></div>`,1),fr=p('<button class="text-red-600 hover:text-red-700 text-sm"><!></button>'),gr=p("<option> </option>"),mr=p('<select id="test-space" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"><option>Select space...</option><!></select>'),xr=p('<input id="test-space" type="text" placeholder="test" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/>'),yr=p('<button class="text-red-600 hover:text-red-700 text-sm"><!></button>'),hr=p("<option> </option>"),wr=p('<select id="prod-space" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"><option>Select space...</option><!></select>'),Er=p('<input id="prod-space" type="text" placeholder="default" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/>'),kr=p('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="flex items-center justify-between mb-4"><div class="flex items-center gap-3"><div class="p-2 bg-green-100 rounded-lg"><!></div> <div><h2 class="text-lg font-semibold text-gray-900">Production Environment</h2> <p class="text-sm text-gray-500">Production configuration (requires MR)</p></div></div> <!></div> <div class="grid grid-cols-2 gap-4"><div><label for="prod-space" class="block text-sm font-medium text-gray-700 mb-2">Elastic Space</label> <!></div> <div><label for="prod-branch" class="block text-sm font-medium text-gray-700 mb-2">Git Branch</label> <input id="prod-branch" type="text" placeholder="main" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/></div></div></div>'),jr=p('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><h2 class="text-lg font-semibold text-gray-900 mb-4">Project Details</h2> <div class="space-y-4"><div><label for="name" class="block text-sm font-medium text-gray-700 mb-2">Project Name *</label> <input id="name" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/></div> <div><label for="description" class="block text-sm font-medium text-gray-700 mb-2">Description</label> <textarea id="description" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"></textarea></div> <div class="grid grid-cols-2 gap-4"><div><label for="elastic" class="block text-sm font-medium text-gray-700 mb-2">Elastic Instance *</label> <select id="elastic" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"></select></div> <div><label for="git" class="block text-sm font-medium text-gray-700 mb-2">Git Repository *</label> <select id="git" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"></select></div></div> <div><label for="path" class="block text-sm font-medium text-gray-700 mb-2">Base Path in Repository</label> <input id="path" type="text" placeholder="detection-rules/" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/></div> <div class="flex items-center gap-2"><input id="active" type="checkbox" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-600"/> <label for="active" class="text-sm font-medium text-gray-700">Project is active</label></div> <div><label class="block text-sm font-medium text-gray-700 mb-2">Sync Mode</label> <div class="grid grid-cols-2 gap-3"><button type="button"><span class="text-sm font-semibold text-gray-900">Full Workflow</span> <span class="text-xs text-gray-500 mt-1">Export, merge requests, and import to production</span></button> <button type="button"><span class="text-sm font-semibold text-gray-900">Export Only</span> <span class="text-xs text-gray-500 mt-1">Only export rules from Elastic to Git</span></button></div></div></div></div> <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="flex items-center gap-3 mb-4"><div class="p-2 bg-blue-100 rounded-lg"><!></div> <div><h2 class="text-lg font-semibold text-gray-900">Automatic Sync</h2> <p class="text-sm text-gray-500">Schedule automatic rule exports to Git</p></div></div> <div class="space-y-4"><div class="flex items-center gap-2"><input id="sync-enabled" type="checkbox" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-600"/> <label for="sync-enabled" class="text-sm font-medium text-gray-700">Enable automatic sync</label></div> <!></div></div> <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="flex items-center justify-between mb-4"><div class="flex items-center gap-3"><div class="p-2 bg-yellow-100 rounded-lg"><!></div> <div><h2 class="text-lg font-semibold text-gray-900"> </h2> <p class="text-sm text-gray-500"> </p></div></div> <!></div> <div class="grid grid-cols-2 gap-4"><div><label for="test-space" class="block text-sm font-medium text-gray-700 mb-2">Elastic Space</label> <!></div> <div><label for="test-branch" class="block text-sm font-medium text-gray-700 mb-2">Git Branch</label> <input id="test-branch" type="text" placeholder="develop" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/></div></div></div> <!> <div class="flex items-center gap-4"><button class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50"><!> Save Changes</button> <a class="px-6 py-3 text-gray-700 hover:text-gray-900 transition-colors">Cancel</a></div>',1),$r=p('<div class="max-w-3xl mx-auto space-y-6"><div><a class="inline-flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900 mb-4"><!> Back to Project</a> <h1 class="text-3xl font-bold text-gray-900">Edit Project</h1> <p class="mt-1 text-sm text-gray-500">Update project settings and environment configuration</p></div> <!> <!> <!></div>');function Hr(de,Y){zt(Y,!0);const ce=()=>rr(ar,"$page",ve),[ve,ue]=tr();let g=c(null),x=c(ie([])),D=c(ie([])),De=c(ie([])),H=c(ie([])),pe=c(!0),Z=c(!1),O=c(""),ee=c(""),U=c(""),te=c(""),P=c(""),W=c(""),re=c(""),ae=c(!0),V=c(!1),oe=c(0),k=c("full"),h=c(""),T=c(""),j=c(""),B=c(""),A=Jt(()=>ce().params.id);Ot(async()=>{await be()});async function be(){try{a(pe,!0),a(g,await E.collection("projects").getOne(e(A),{expand:"elastic_instance,git_repository"}),!0),a(U,e(g).name,!0),a(te,e(g).description||"",!0),a(P,e(g).elastic_instance,!0),a(W,e(g).git_repository,!0),a(re,e(g).git_path||"",!0),a(ae,e(g).is_active,!0),a(V,e(g).sync_enabled||!1,!0),a(oe,e(g).auto_sync_interval||0,!0),a(k,e(g).sync_mode||"full",!0),a(x,await E.collection("environments").getFullList({filter:`project = "${e(A)}"`}),!0);const i=e(x).find(v=>v.name==="test"),n=e(x).find(v=>v.name==="production");i&&(a(h,i.elastic_space,!0),a(T,i.git_branch,!0)),n&&(a(j,n.elastic_space,!0),a(B,n.git_branch,!0)),a(D,await E.collection("elastic_instances").getFullList({filter:"is_active = true"}),!0),a(De,await E.collection("git_repositories").getFullList({filter:"is_active = true"}),!0),await Oe()}catch(i){a(O,i.message,!0)}finally{a(pe,!1)}}async function Oe(){if(e(P))try{const i=e(D).find(n=>n.id===e(P));i&&i.spaces&&a(H,i.spaces,!0)}catch(i){console.error("Failed to load spaces:",i)}}Ht(()=>{e(P)&&e(D).length>0&&Oe()});async function ft(){try{a(Z,!0),a(O,""),a(ee,""),await E.collection("projects").update(e(A),{name:e(U),description:e(te)||"",elastic_instance:e(P),elastic_space:e(h),git_repository:e(W),git_path:e(re)||"",is_active:e(ae),sync_enabled:e(V),auto_sync_interval:e(V)?e(oe):0,sync_mode:e(k)});const i=e(x).find(v=>v.name==="test");i?await E.collection("environments").update(i.id,{elastic_space:e(h),git_branch:e(T)}):e(h)&&e(T)&&await E.collection("environments").create({project:e(A),name:"test",elastic_space:e(h),git_branch:e(T),requires_approval:!1,auto_deploy:!0});const n=e(x).find(v=>v.name==="production");n?await E.collection("environments").update(n.id,{elastic_space:e(j),git_branch:e(B)}):e(j)&&e(B)&&await E.collection("environments").create({project:e(A),name:"production",elastic_space:e(j),git_branch:e(B),requires_approval:!0,auto_deploy:!1}),a(ee,"Project saved successfully!"),await be()}catch(i){a(O,i.message,!0)}finally{a(Z,!1)}}async function Ve(i){const n=e(x).find(v=>v.name===i);if(n&&confirm(`Are you sure you want to delete the ${i} environment?`))try{await E.collection("environments").delete(n.id),i==="test"?(a(h,""),a(T,"")):(a(j,""),a(B,"")),await be()}catch(v){a(O,v.message,!0)}}var _e=$r();Yt("1h9ouny",i=>{Wt(()=>{var n;Nt.title=`Edit ${(((n=e(g))==null?void 0:n.name)||"Project")??""} - Elastic Git Sync`})});var fe=r(_e),ge=r(fe),gt=r(ge);or(gt,{class:"w-4 h-4"}),M(),t(ge),M(4),t(fe);var ze=o(fe,2);{var mt=i=>{var n=cr(),v=r(n),z=r(v,!0);t(v),t(n),G(()=>I(z,e(O))),u(i,n)};w(ze,i=>{e(O)&&i(mt)})}var He=o(ze,2);{var xt=i=>{var n=vr(),v=r(n),z=r(v,!0);t(v),t(n),G(()=>I(z,e(ee))),u(i,n)};w(He,i=>{e(ee)&&i(xt)})}var yt=o(He,2);{var ht=i=>{var n=ur();u(i,n)},wt=i=>{var n=jr(),v=Ce(n),z=o(r(v),2),me=r(z),Ue=o(r(me),2);R(Ue),t(me);var xe=o(me,2),We=o(r(xe),2);Kt(We),t(xe);var ye=o(xe,2),he=r(ye),we=o(r(he),2);le(we,21,()=>e(D),ne,(s,l)=>{var d=pr(),f=r(d,!0);t(d);var b={};G(()=>{I(f,e(l).name),b!==(b=e(l).id)&&(d.value=(d.__value=e(l).id)??"")}),u(s,d)}),t(we),t(he);var Ne=o(he,2),Ee=o(r(Ne),2);le(Ee,21,()=>e(De),ne,(s,l)=>{var d=br(),f=r(d,!0);t(d);var b={};G(()=>{I(f,e(l).name),b!==(b=e(l).id)&&(d.value=(d.__value=e(l).id)??"")}),u(s,d)}),t(Ee),t(Ne),t(ye);var ke=o(ye,2),Je=o(r(ke),2);R(Je),t(ke);var je=o(ke,2),Ke=r(je);R(Ke),M(2),t(je);var Qe=o(je,2),Xe=o(r(Qe),2),$e=r(Xe),Ye=o($e,2);t(Xe),t(Qe),t(z),t(v);var Se=o(v,2),Pe=r(Se),Ze=r(Pe),Et=r(Ze);sr(Et,{class:"w-5 h-5 text-blue-600"}),t(Ze),M(2),t(Pe);var et=o(Pe,2),Ie=r(et),tt=r(Ie);R(tt),M(2),t(Ie);var kt=o(Ie,2);{var jt=s=>{var l=_r(),d=Ce(l),f=o(r(d),2),b=r(f);b.value=b.__value=5;var $=o(b);$.value=$.__value=15;var y=o($);y.value=y.__value=30;var F=o(y);F.value=F.__value=60;var S=o(F);S.value=S.__value=120;var L=o(S);L.value=L.__value=360;var J=o(L);J.value=J.__value=720;var se=o(J);se.value=se.__value=1440,t(f),t(d),M(2),X(f,()=>e(oe),Fe=>a(oe,Fe)),u(s,l)};w(kt,s=>{e(V)&&s(jt)})}t(et),t(Se);var Ge=o(Se,2),Me=r(Ge),Re=r(Me),Te=r(Re),$t=r(Te);ir($t,{class:"w-5 h-5 text-yellow-600"}),t(Te);var rt=o(Te,2),Be=r(rt),St=r(Be,!0);t(Be);var at=o(Be,2),Pt=r(at,!0);t(at),t(rt),t(Re);var It=o(Re,2);{var Gt=s=>{var l=fr(),d=r(l);_t(d,{class:"w-4 h-4"}),t(l),Q("click",l,()=>Ve("test")),u(s,l)};w(It,s=>{e(x).find(l=>l.name==="test")&&s(Gt)})}t(Me);var ot=o(Me,2),Ae=r(ot),Mt=o(r(Ae),2);{var Rt=s=>{var l=mr(),d=r(l);d.value=d.__value="";var f=o(d);le(f,17,()=>e(H),ne,(b,$)=>{var y=gr(),F=r(y,!0);t(y);var S={};G(()=>{I(F,e($)),S!==(S=e($))&&(y.value=(y.__value=e($))??"")}),u(b,y)}),t(l),X(l,()=>e(h),b=>a(h,b)),u(s,l)},Tt=s=>{var l=xr();R(l),C(l,()=>e(h),d=>a(h,d)),u(s,l)};w(Mt,s=>{e(H).length>0?s(Rt):s(Tt,!1)})}t(Ae);var st=o(Ae,2),it=o(r(st),2);R(it),t(st),t(ot),t(Ge);var lt=o(Ge,2);{var Bt=s=>{var l=kr(),d=r(l),f=r(d),b=r(f),$=r(b);lr($,{class:"w-5 h-5 text-green-600"}),t(b),M(2),t(f);var y=o(f,2);{var F=m=>{var _=yr(),q=r(_);_t(q,{class:"w-4 h-4"}),t(_),Q("click",_,()=>Ve("production")),u(m,_)};w(y,m=>{e(x).find(_=>_.name==="production")&&m(F)})}t(d);var S=o(d,2),L=r(S),J=o(r(L),2);{var se=m=>{var _=wr(),q=r(_);q.value=q.__value="";var Ct=o(q);le(Ct,17,()=>e(H),ne,(Le,qe)=>{var K=hr(),Dt=r(K,!0);t(K);var vt={};G(()=>{I(Dt,e(qe)),vt!==(vt=e(qe))&&(K.value=(K.__value=e(qe))??"")}),u(Le,K)}),t(_),X(_,()=>e(j),Le=>a(j,Le)),u(m,_)},Fe=m=>{var _=Er();R(_),C(_,()=>e(j),q=>a(j,q)),u(m,_)};w(J,m=>{e(H).length>0?m(se):m(Fe,!1)})}t(L);var dt=o(L,2),ct=o(r(dt),2);R(ct),t(dt),t(S),t(l),C(ct,()=>e(B),m=>a(B,m)),u(s,l)};w(lt,s=>{e(k)==="full"&&s(Bt)})}var nt=o(lt,2),N=r(nt),At=r(N);{var Ft=s=>{nr(s,{class:"w-5 h-5 animate-spin"})},Lt=s=>{dr(s,{class:"w-5 h-5"})};w(At,s=>{e(Z)?s(Ft):s(Lt,!1)})}M(),t(N);var qt=o(N,2);t(nt),G(()=>{pt($e,1,`flex flex-col items-start p-3 border-2 rounded-lg transition-colors text-left
								${e(k)==="full"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`),pt(Ye,1,`flex flex-col items-start p-3 border-2 rounded-lg transition-colors text-left
								${e(k)==="export_only"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`),I(St,e(k)==="export_only"?"Environment":"Test Environment"),I(Pt,e(k)==="export_only"?"Elastic space and Git branch for export":"Development and testing configuration"),N.disabled=e(Z)||!e(U)||!e(P)||!e(W),ut(qt,"href",`/projects/${e(A)??""}`)}),C(Ue,()=>e(U),s=>a(U,s)),C(We,()=>e(te),s=>a(te,s)),X(we,()=>e(P),s=>a(P,s)),X(Ee,()=>e(W),s=>a(W,s)),C(Je,()=>e(re),s=>a(re,s)),bt(Ke,()=>e(ae),s=>a(ae,s)),Q("click",$e,()=>a(k,"full")),Q("click",Ye,()=>a(k,"export_only")),bt(tt,()=>e(V),s=>a(V,s)),C(it,()=>e(T),s=>a(T,s)),Q("click",N,ft),u(i,n)};w(yt,i=>{e(pe)?i(ht):i(wt,!1)})}t(_e),G(()=>ut(ge,"href",`/projects/${e(A)??""}`)),u(de,_e),Ut(),ue()}export{Hr as component};

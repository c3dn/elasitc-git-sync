import"../chunks/CWj6FrbW.js";import{i as Qe}from"../chunks/COK2pY8o.js";import{o as We,s as m}from"../chunks/BnHnlVXU.js";import{p as Xe,a as l,b as Ze,e as $e,d as y,s as a,$ as et,h as i,i as e,g as o,r as s,m as d,n as C,j as E,t as q,o as tt,c as Ce,f as Re,l as ie}from"../chunks/BbuzmxRY.js";import{i as p}from"../chunks/XgF_cVEg.js";import{r as z,a as rt,c as at,e as st,b as it,i as ot}from"../chunks/Bm_MFDQ1.js";import{h as nt}from"../chunks/BwaF3Q6U.js";import{b as oe,a as lt}from"../chunks/BjJ5yzjH.js";import{p as R}from"../chunks/BVZH3wAp.js";import{P as ct}from"../chunks/D_FWaIFH.js";import{L as Fe}from"../chunks/Cr7rThFx.js";import{R as Le,P as dt}from"../chunks/CfIP2vrm.js";import{T as vt}from"../chunks/-YWqKXAd.js";import{C as pt}from"../chunks/C4YxXooL.js";import{C as ut}from"../chunks/B5_3TA3C.js";var bt=y('<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4"><p class="text-sm text-yellow-800 font-medium">SSL certificate verification is disabled</p> <p class="text-xs text-yellow-700 mt-1">The DISABLE_SSL_VERIFY environment variable is set to true. All outgoing HTTPS connections skip certificate verification.</p></div>'),ft=y('<button class="inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors"><!> Add Git Repository</button>'),mt=y('<div class="mb-4 bg-red-50 border border-red-200 rounded-lg p-4"><p class="text-sm text-red-800"> </p></div>'),gt=y('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><h3 class="text-lg font-semibold text-gray-900 mb-4"> </h3> <!> <div class="space-y-4"><div><label for="name" class="block text-sm font-medium text-gray-700 mb-2">Repository Name *</label> <input id="name" type="text" placeholder="Security Rules Repository" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"/></div> <div><label for="provider" class="block text-sm font-medium text-gray-700 mb-2">Provider *</label> <select id="provider" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"><option>GitLab</option><option>GitHub</option><option>Generic Git</option></select></div> <div><label for="url" class="block text-sm font-medium text-gray-700 mb-2">Repository URL *</label> <input id="url" type="url" placeholder="https://gitlab.com/your-org/security-rules" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"/> <p class="text-xs text-gray-500 mt-1">Full HTTPS URL to your Git repository</p></div> <div><label for="token" class="block text-sm font-medium text-gray-700 mb-2"> </label> <input id="token" type="password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"/> <p class="text-xs text-gray-500 mt-1"><!></p></div> <div><label for="branch" class="block text-sm font-medium text-gray-700 mb-2">Default Branch *</label> <input id="branch" type="text" placeholder="main" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"/></div> <div><label for="base-path" class="block text-sm font-medium text-gray-700 mb-2">Base Path (optional)</label> <input id="base-path" type="text" placeholder="rules/" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-600 focus:border-transparent"/> <p class="text-xs text-gray-500 mt-1">Default subdirectory for storing rules</p></div> <div class="flex items-center gap-2"><input id="is-active" type="checkbox" class="w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-600"/> <label for="is-active" class="text-sm font-medium text-gray-700">Active</label></div> <div class="flex items-center gap-3 pt-4"><button class="inline-flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"><!> Test Connection</button> <button class="inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"><!></button> <button class="px-4 py-2 text-gray-700 hover:text-gray-900 transition-colors">Cancel</button></div></div></div>'),_t=y('<div class="flex items-center justify-center py-12"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"></div></div>'),yt=y('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"><p class="text-gray-500">No Git repositories configured yet.</p></div>'),xt=y('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="flex items-start justify-between"><div class="flex-1"><div class="flex items-center gap-3 mb-2"><h3 class="text-lg font-semibold text-gray-900"> </h3> <!> <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800"> </span></div> <p class="text-sm text-gray-600 mb-1"> </p> <p class="text-xs text-gray-500"> <!></p></div> <div class="flex items-center gap-2"><span> </span></div></div> <div class="flex items-center gap-2 mt-4 pt-4 border-t border-gray-200"><button class="inline-flex items-center gap-2 px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm"><!> Test Connection</button> <button class="inline-flex items-center gap-2 px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm"><!> Edit</button> <button class="ml-auto inline-flex items-center gap-2 px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors text-sm"><!> Delete</button></div></div>'),ht=y('<div class="space-y-4"></div>'),wt=y('<div class="space-y-6"><!> <!> <!> <!></div>');function Bt(De,Ee){Xe(Ee,!1);let ne=d([]),I=d(!1),S=d(!1),le=d(!1),f=d(""),g=d(null),Se=d(!1),U=d(""),x=d(""),_=d("gitlab"),h=d(""),B=d("main"),K=d(""),Q=d(!0);We(async()=>{await ce();try{const n=await(await fetch(`${R.baseUrl}/api/settings/ssl-status`)).json();a(Se,n.ssl_verification_disabled)}catch{}});async function ce(){try{a(S,!0),a(ne,await R.collection("git_repositories").getFullList({sort:"-created"}))}catch(t){a(f,t.message)}finally{a(S,!1)}}function Te(){a(U,""),a(x,""),a(_,"gitlab"),a(h,""),a(B,"main"),a(K,""),a(Q,!0),a(g,null),a(f,"")}function Ie(){Te(),a(I,!0)}function Ue(t){a(g,t.id),a(U,t.name),a(x,t.url),a(_,t.provider),a(h,t.access_token),a(B,t.default_branch),a(K,t.base_path||""),a(Q,t.is_active),a(f,""),a(I,!0)}function Pe(){a(I,!1),Te()}async function Be(){var t;try{a(le,!0),a(f,"");const v=await(await fetch(`${R.baseUrl}/api/connection/test`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"git",config:{url:e(x),provider:e(_),access_token:e(h)}})})).json();v.success?alert(`Connection successful! Found ${((t=v.branches)==null?void 0:t.length)||0} branches.`):a(f,v.message)}catch(n){a(f,n.message)}finally{a(le,!1)}}async function Oe(){try{a(S,!0),a(f,"");const t={name:e(U),url:e(x),provider:e(_),access_token:e(h),default_branch:e(B),base_path:e(K)||"",is_active:e(Q)};e(g)?await R.collection("git_repositories").update(e(g),t):await R.collection("git_repositories").create(t),Pe(),await ce()}catch(t){a(f,t.message)}finally{a(S,!1)}}async function Ne(t){if(confirm("Are you sure you want to delete this repository?"))try{await R.collection("git_repositories").delete(t),await ce()}catch(n){alert(`Error: ${n.message}`)}}async function He(t){try{const v=await(await fetch(`${R.baseUrl}/api/connection/test`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"git",config:{url:t.url,provider:t.provider,access_token:t.access_token}})})).json();await R.collection("git_repositories").update(t.id,{connection_status:v.success?"success":"failed",last_connection_test:new Date().toISOString()}),await ce()}catch(n){console.error("Connection test failed:",n)}}Qe();var me=wt();nt("xtvn8n",t=>{$e(()=>{et.title="Git Repositories - Settings"})});var Ge=i(me);{var Je=t=>{var n=bt();l(t,n)};p(Ge,t=>{e(Se)&&t(Je)})}var Ae=o(Ge,2);{var Ve=t=>{var n=ft(),v=i(n);ct(v,{class:"w-5 h-5"}),C(),s(n),E("click",n,Ie),l(t,n)};p(Ae,t=>{e(I)||t(Ve)})}var je=o(Ae,2);{var Ye=t=>{var n=gt(),v=i(n),ge=i(v,!0);s(v);var de=o(v,2);{var w=r=>{var b=mt(),fe=i(b),we=i(fe,!0);s(fe),s(b),q(()=>m(we,e(f))),l(r,b)};p(de,r=>{e(f)&&r(w)})}var k=o(de,2),W=i(k),c=o(i(W),2);z(c),s(W);var T=o(W,2),P=o(i(T),2);q(()=>{e(_),tt(()=>{})});var G=i(P);G.value=G.__value="gitlab";var A=o(G);A.value=A.__value="github";var O=o(A);O.value=O.__value="generic",s(P),s(T);var X=o(T,2),Z=o(i(X),2);z(Z),C(2),s(X);var $=o(X,2),ee=i($),ve=i(ee);s(ee);var N=o(ee,2);z(N);var H=o(N,2),_e=i(H);{var pe=r=>{var b=ie("Create a project access token with API and write_repository scopes");l(r,b)},ue=r=>{var b=Ce(),fe=Re(b);{var we=M=>{var ke=ie("Create a personal access token with repo scope");l(M,ke)},Ke=M=>{var ke=ie("Token for authentication");l(M,ke)};p(fe,M=>{e(_)==="github"?M(we):M(Ke,!1)},!0)}l(r,b)};p(_e,r=>{e(_)==="gitlab"?r(pe):r(ue,!1)})}s(H),s($);var te=o($,2),be=o(i(te),2);z(be),s(te);var J=o(te,2),V=o(i(J),2);z(V),C(2),s(J);var re=o(J,2),ae=i(re);z(ae),C(2),s(re);var j=o(re,2),F=i(j),Y=i(F);{var ye=r=>{Fe(r,{class:"w-4 h-4 animate-spin"})},se=r=>{Le(r,{class:"w-4 h-4"})};p(Y,r=>{e(le)?r(ye):r(se,!1)})}C(),s(F);var L=o(F,2),u=i(L);{var D=r=>{Fe(r,{class:"w-4 h-4 animate-spin"})},xe=r=>{var b=ie();q(()=>m(b,e(g)?"Update":"Save")),l(r,b)};p(u,r=>{e(S)?r(D):r(xe,!1)})}s(L);var he=o(L,2);s(j),s(k),s(n),q(()=>{m(ge,e(g)?"Edit Git Repository":"Add Git Repository"),m(ve,`Access Token ${e(g)?"(leave empty to keep current)":"*"}`),rt(N,"placeholder",e(g)?"••••••••":"Your Git access token"),F.disabled=!e(x)||!e(h)||e(le),L.disabled=e(S)||!e(U)||!e(x)||!e(g)&&!e(h)||!e(B)}),oe(c,()=>e(U),r=>a(U,r)),at(P,()=>e(_),r=>a(_,r)),oe(Z,()=>e(x),r=>a(x,r)),oe(N,()=>e(h),r=>a(h,r)),oe(be,()=>e(B),r=>a(B,r)),oe(V,()=>e(K),r=>a(K,r)),lt(ae,()=>e(Q),r=>a(Q,r)),E("click",F,Be),E("click",L,Oe),E("click",he,Pe),l(t,n)};p(je,t=>{e(I)&&t(Ye)})}var Me=o(je,2);{var qe=t=>{var n=_t();l(t,n)},ze=t=>{var n=Ce(),v=Re(n);{var ge=w=>{var k=yt();l(w,k)},de=w=>{var k=ht();st(k,5,()=>e(ne),ot,(W,c)=>{var T=xt(),P=i(T),G=i(P),A=i(G),O=i(A),X=i(O,!0);s(O);var Z=o(O,2);{var $=u=>{pt(u,{class:"w-5 h-5 text-green-600"})},ee=u=>{var D=Ce(),xe=Re(D);{var he=r=>{ut(r,{class:"w-5 h-5 text-red-600"})};p(xe,r=>{e(c).connection_status==="failed"&&r(he)},!0)}l(u,D)};p(Z,u=>{e(c).connection_status==="success"?u($):u(ee,!1)})}var ve=o(Z,2),N=i(ve,!0);s(ve),s(A);var H=o(A,2),_e=i(H,!0);s(H);var pe=o(H,2),ue=i(pe),te=o(ue);{var be=u=>{var D=ie();q(()=>m(D,`• Path: ${e(c).base_path??""}`)),l(u,D)};p(te,u=>{e(c).base_path&&u(be)})}s(pe),s(G);var J=o(G,2),V=i(J),re=i(V,!0);s(V),s(J),s(P);var ae=o(P,2),j=i(ae),F=i(j);Le(F,{class:"w-4 h-4"}),C(),s(j);var Y=o(j,2),ye=i(Y);dt(ye,{class:"w-4 h-4"}),C(),s(Y);var se=o(Y,2),L=i(se);vt(L,{class:"w-4 h-4"}),C(),s(se),s(ae),s(T),q(()=>{m(X,e(c).name),m(N,e(c).provider),m(_e,e(c).url),m(ue,`Branch: ${e(c).default_branch??""} `),it(V,1,`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
								${e(c).is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`),m(re,e(c).is_active?"Active":"Inactive")}),E("click",j,()=>He(e(c))),E("click",Y,()=>Ue(e(c))),E("click",se,()=>Ne(e(c).id)),l(W,T)}),s(k),l(w,k)};p(v,w=>{e(ne).length===0&&!e(I)?w(ge):w(de,!1)},!0)}l(t,n)};p(Me,t=>{e(S)&&e(ne).length===0?t(qe):t(ze,!1)})}s(me),l(De,me),Ze()}export{Bt as component};

import"../chunks/CWj6FrbW.js";import{o as Or,s as I}from"../chunks/O7RWNxBF.js";import{c as Vr,f as Ce,a as u,p as zr,l as c,R as ie,S as Hr,i as e,t as G,b as Ur,s as a,T as Wr,h as t,d as p,$ as Nr,n as M,r,g as o,U as Jr,V as Kr,j as Q}from"../chunks/C9NYA0Nw.js";import{i as k}from"../chunks/D2ldot_M.js";import{I as Qr,s as Xr,b as ur,r as R,e as le,i as de,a as pr,c as X}from"../chunks/rMS1oNTx.js";import{h as Yr}from"../chunks/k5AYXn5z.js";import{b as C,a as gr}from"../chunks/DkcqxK1V.js";import{l as Zr,s as et,a as rt,b as tt}from"../chunks/Cs0PMOxO.js";import{p as at}from"../chunks/2Ejqapzg.js";import"../chunks/--SkU8XW.js";import{p as w}from"../chunks/BUCyip3L.js";import{A as ot}from"../chunks/NOXAU2LB.js";import{C as st}from"../chunks/BeHt4r-J.js";import{T as it}from"../chunks/ChWmmJ1c.js";import{T as br}from"../chunks/Bv-fdLbk.js";import{R as lt}from"../chunks/Cx4sQyjC.js";import{L as dt}from"../chunks/suUg0HP9.js";import"../chunks/Dl2LfGm4.js";function nt(ne,Y){const ce=Zr(Y,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7"}]];Qr(ne,et({name:"save"},()=>ce,{get iconNode(){return ve},children:(ue,_)=>{var m=Vr(),D=Ce(m);Xr(D,Y,"default",{}),u(ue,m)},$$slots:{default:!0}}))}var ct=p('<div class="bg-red-50 border border-red-200 rounded-lg p-4"><p class="text-sm text-red-800"> </p></div>'),vt=p('<div class="bg-green-50 border border-green-200 rounded-lg p-4"><p class="text-sm text-green-800"> </p></div>'),ut=p('<div class="flex items-center justify-center py-12"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div></div>'),pt=p("<option> </option>"),gt=p("<option> </option>"),bt=p(`<div><label for="sync-interval" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Sync Interval</label> <select id="sync-interval" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"><option>Every 5 minutes</option><option>Every 15 minutes</option><option>Every 30 minutes</option><option>Every hour</option><option>Every 2 hours</option><option>Every 6 hours</option><option>Every 12 hours</option><option>Every 24 hours</option></select></div> <div class="bg-blue-50 border border-blue-200 rounded-lg p-3"><p class="text-sm text-blue-800">When enabled, rules from your Test environment will be automatically exported to Git at the selected interval.
							This only exports from Elastic to Git - it does not import rules to Production.</p></div>`,1),yt=p('<button class="text-red-600 hover:text-red-700 text-sm"><!></button>'),_t=p("<option> </option>"),ft=p('<select id="test-space" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"><option>Select space...</option><!></select>'),mt=p('<input id="test-space" type="text" placeholder="test" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/>'),xt=p('<button class="text-red-600 hover:text-red-700 text-sm"><!></button>'),ht=p("<option> </option>"),kt=p('<select id="prod-space" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"><option>Select space...</option><!></select>'),wt=p('<input id="prod-space" type="text" placeholder="default" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/>'),Et=p('<div class="bg-white dark:bg-gray-900 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"><div class="flex items-center justify-between mb-4"><div class="flex items-center gap-3"><div class="p-2 bg-green-100 rounded-lg"><!></div> <div><h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Production Environment</h2> <p class="text-sm text-gray-500 dark:text-gray-400">Production configuration (requires MR)</p></div></div> <!></div> <div class="grid grid-cols-2 gap-4"><div><label for="prod-space" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Elastic Space</label> <!></div> <div><label for="prod-branch" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Git Branch</label> <input id="prod-branch" type="text" placeholder="main" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/></div></div></div>'),jt=p('<div class="bg-white dark:bg-gray-900 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"><h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Project Details</h2> <div class="space-y-4"><div><label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Project Name *</label> <input id="name" type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/></div> <div><label for="description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description</label> <textarea id="description" rows="2" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"></textarea></div> <div class="grid grid-cols-2 gap-4"><div><label for="elastic" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Elastic Instance *</label> <select id="elastic" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"></select></div> <div><label for="git" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Git Repository *</label> <select id="git" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"></select></div></div> <div><label for="path" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Base Path in Repository</label> <input id="path" type="text" placeholder="detection-rules/" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/></div> <div class="flex items-center gap-2"><input id="active" type="checkbox" class="w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-600"/> <label for="active" class="text-sm font-medium text-gray-700 dark:text-gray-300">Project is active</label></div> <div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Sync Mode</label> <div class="grid grid-cols-2 gap-3"><button type="button"><span class="text-sm font-semibold text-gray-900 dark:text-gray-100">Full Workflow</span> <span class="text-xs text-gray-500 dark:text-gray-400 mt-1">Export, merge requests, and import to production</span></button> <button type="button"><span class="text-sm font-semibold text-gray-900 dark:text-gray-100">Export Only</span> <span class="text-xs text-gray-500 dark:text-gray-400 mt-1">Only export rules from Elastic to Git</span></button></div></div></div></div> <div class="bg-white dark:bg-gray-900 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"><div class="flex items-center gap-3 mb-4"><div class="p-2 bg-blue-100 rounded-lg"><!></div> <div><h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Automatic Sync</h2> <p class="text-sm text-gray-500 dark:text-gray-400">Schedule automatic rule exports to Git</p></div></div> <div class="space-y-4"><div class="flex items-center gap-2"><input id="sync-enabled" type="checkbox" class="w-4 h-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-600"/> <label for="sync-enabled" class="text-sm font-medium text-gray-700 dark:text-gray-300">Enable automatic sync</label></div> <!></div></div> <div class="bg-white dark:bg-gray-900 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"><div class="flex items-center justify-between mb-4"><div class="flex items-center gap-3"><div class="p-2 bg-yellow-100 rounded-lg"><!></div> <div><h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100"> </h2> <p class="text-sm text-gray-500 dark:text-gray-400"> </p></div></div> <!></div> <div class="grid grid-cols-2 gap-4"><div><label for="test-space" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Elastic Space</label> <!></div> <div><label for="test-branch" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Git Branch</label> <input id="test-branch" type="text" placeholder="develop" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"/></div></div></div> <!> <div class="flex items-center gap-4"><button class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50"><!> Save Changes</button> <a class="px-6 py-3 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100 transition-colors">Cancel</a></div>',1),$t=p('<div class="max-w-3xl mx-auto space-y-6"><div><a class="inline-flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 mb-4"><!> Back to Project</a> <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100">Edit Project</h1> <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Update project settings and environment configuration</p></div> <!> <!> <!></div>');function Ut(ne,Y){zr(Y,!0);const ce=()=>tt(at,"$page",ve),[ve,ue]=rt();let _=c(null),m=c(ie([])),D=c(ie([])),De=c(ie([])),H=c(ie([])),pe=c(!0),Z=c(!1),O=c(""),ee=c(""),U=c(""),re=c(""),P=c(""),W=c(""),te=c(""),ae=c(!0),V=c(!1),oe=c(0),E=c("full"),h=c(""),T=c(""),j=c(""),B=c(""),A=Jr(()=>ce().params.id);Or(async()=>{await ge()});async function ge(){try{a(pe,!0),a(_,await w.collection("projects").getOne(e(A),{expand:"elastic_instance,git_repository"}),!0),a(U,e(_).name,!0),a(re,e(_).description||"",!0),a(P,e(_).elastic_instance,!0),a(W,e(_).git_repository,!0),a(te,e(_).git_path||"",!0),a(ae,e(_).is_active,!0),a(V,e(_).sync_enabled||!1,!0),a(oe,e(_).auto_sync_interval||0,!0),a(E,e(_).sync_mode||"full",!0),a(m,await w.collection("environments").getFullList({filter:`project = "${e(A)}"`}),!0);const i=e(m).find(v=>v.name==="test"),d=e(m).find(v=>v.name==="production");i&&(a(h,i.elastic_space,!0),a(T,i.git_branch,!0)),d&&(a(j,d.elastic_space,!0),a(B,d.git_branch,!0)),a(D,await w.collection("elastic_instances").getFullList({filter:"is_active = true"}),!0),a(De,await w.collection("git_repositories").getFullList({filter:"is_active = true"}),!0),await Oe()}catch(i){a(O,i.message,!0)}finally{a(pe,!1)}}async function Oe(){if(e(P))try{const i=e(D).find(d=>d.id===e(P));i&&i.spaces&&a(H,i.spaces,!0)}catch(i){console.error("Failed to load spaces:",i)}}Hr(()=>{e(P)&&e(D).length>0&&Oe()});async function yr(){try{a(Z,!0),a(O,""),a(ee,""),await w.collection("projects").update(e(A),{name:e(U),description:e(re)||"",elastic_instance:e(P),elastic_space:e(h),git_repository:e(W),git_path:e(te)||"",is_active:e(ae),sync_enabled:e(V),auto_sync_interval:e(V)?e(oe):0,sync_mode:e(E)});const i=e(m).find(v=>v.name==="test");i?await w.collection("environments").update(i.id,{elastic_space:e(h),git_branch:e(T)}):e(h)&&e(T)&&await w.collection("environments").create({project:e(A),name:"test",elastic_space:e(h),git_branch:e(T),requires_approval:!1,auto_deploy:!0});const d=e(m).find(v=>v.name==="production");d?await w.collection("environments").update(d.id,{elastic_space:e(j),git_branch:e(B)}):e(j)&&e(B)&&await w.collection("environments").create({project:e(A),name:"production",elastic_space:e(j),git_branch:e(B),requires_approval:!0,auto_deploy:!1}),a(ee,"Project saved successfully!"),await ge()}catch(i){a(O,i.message,!0)}finally{a(Z,!1)}}async function Ve(i){const d=e(m).find(v=>v.name===i);if(d&&confirm(`Are you sure you want to delete the ${i} environment?`))try{await w.collection("environments").delete(d.id),i==="test"?(a(h,""),a(T,"")):(a(j,""),a(B,"")),await ge()}catch(v){a(O,v.message,!0)}}var be=$t();Yr("1h9ouny",i=>{Wr(()=>{var d;Nr.title=`Edit ${(((d=e(_))==null?void 0:d.name)||"Project")??""} - Elastic Git Sync`})});var ye=t(be),_e=t(ye),_r=t(_e);ot(_r,{class:"w-4 h-4"}),M(),r(_e),M(4),r(ye);var ze=o(ye,2);{var fr=i=>{var d=ct(),v=t(d),z=t(v,!0);r(v),r(d),G(()=>I(z,e(O))),u(i,d)};k(ze,i=>{e(O)&&i(fr)})}var He=o(ze,2);{var mr=i=>{var d=vt(),v=t(d),z=t(v,!0);r(v),r(d),G(()=>I(z,e(ee))),u(i,d)};k(He,i=>{e(ee)&&i(mr)})}var xr=o(He,2);{var hr=i=>{var d=ut();u(i,d)},kr=i=>{var d=jt(),v=Ce(d),z=o(t(v),2),fe=t(z),Ue=o(t(fe),2);R(Ue),r(fe);var me=o(fe,2),We=o(t(me),2);Kr(We),r(me);var xe=o(me,2),he=t(xe),ke=o(t(he),2);le(ke,21,()=>e(D),de,(s,l)=>{var n=pt(),y=t(n,!0);r(n);var g={};G(()=>{I(y,e(l).name),g!==(g=e(l).id)&&(n.value=(n.__value=e(l).id)??"")}),u(s,n)}),r(ke),r(he);var Ne=o(he,2),we=o(t(Ne),2);le(we,21,()=>e(De),de,(s,l)=>{var n=gt(),y=t(n,!0);r(n);var g={};G(()=>{I(y,e(l).name),g!==(g=e(l).id)&&(n.value=(n.__value=e(l).id)??"")}),u(s,n)}),r(we),r(Ne),r(xe);var Ee=o(xe,2),Je=o(t(Ee),2);R(Je),r(Ee);var je=o(Ee,2),Ke=t(je);R(Ke),M(2),r(je);var Qe=o(je,2),Xe=o(t(Qe),2),$e=t(Xe),Ye=o($e,2);r(Xe),r(Qe),r(z),r(v);var Se=o(v,2),Pe=t(Se),Ze=t(Pe),wr=t(Ze);st(wr,{class:"w-5 h-5 text-blue-600"}),r(Ze),M(2),r(Pe);var er=o(Pe,2),Ie=t(er),rr=t(Ie);R(rr),M(2),r(Ie);var Er=o(Ie,2);{var jr=s=>{var l=bt(),n=Ce(l),y=o(t(n),2),g=t(y);g.value=g.__value=5;var $=o(g);$.value=$.__value=15;var x=o($);x.value=x.__value=30;var F=o(x);F.value=F.__value=60;var S=o(F);S.value=S.__value=120;var L=o(S);L.value=L.__value=360;var J=o(L);J.value=J.__value=720;var se=o(J);se.value=se.__value=1440,r(y),r(n),M(2),X(y,()=>e(oe),Fe=>a(oe,Fe)),u(s,l)};k(Er,s=>{e(V)&&s(jr)})}r(er),r(Se);var Ge=o(Se,2),Me=t(Ge),Re=t(Me),Te=t(Re),$r=t(Te);it($r,{class:"w-5 h-5 text-yellow-600"}),r(Te);var tr=o(Te,2),Be=t(tr),Sr=t(Be,!0);r(Be);var ar=o(Be,2),Pr=t(ar,!0);r(ar),r(tr),r(Re);var Ir=o(Re,2);{var Gr=s=>{var l=yt(),n=t(l);br(n,{class:"w-4 h-4"}),r(l),Q("click",l,()=>Ve("test")),u(s,l)};k(Ir,s=>{e(m).find(l=>l.name==="test")&&s(Gr)})}r(Me);var or=o(Me,2),Ae=t(or),Mr=o(t(Ae),2);{var Rr=s=>{var l=ft(),n=t(l);n.value=n.__value="";var y=o(n);le(y,17,()=>e(H),de,(g,$)=>{var x=_t(),F=t(x,!0);r(x);var S={};G(()=>{I(F,e($)),S!==(S=e($))&&(x.value=(x.__value=e($))??"")}),u(g,x)}),r(l),X(l,()=>e(h),g=>a(h,g)),u(s,l)},Tr=s=>{var l=mt();R(l),C(l,()=>e(h),n=>a(h,n)),u(s,l)};k(Mr,s=>{e(H).length>0?s(Rr):s(Tr,!1)})}r(Ae);var sr=o(Ae,2),ir=o(t(sr),2);R(ir),r(sr),r(or),r(Ge);var lr=o(Ge,2);{var Br=s=>{var l=Et(),n=t(l),y=t(n),g=t(y),$=t(g);lt($,{class:"w-5 h-5 text-green-600"}),r(g),M(2),r(y);var x=o(y,2);{var F=f=>{var b=xt(),q=t(b);br(q,{class:"w-4 h-4"}),r(b),Q("click",b,()=>Ve("production")),u(f,b)};k(x,f=>{e(m).find(b=>b.name==="production")&&f(F)})}r(n);var S=o(n,2),L=t(S),J=o(t(L),2);{var se=f=>{var b=kt(),q=t(b);q.value=q.__value="";var Cr=o(q);le(Cr,17,()=>e(H),de,(Le,qe)=>{var K=ht(),Dr=t(K,!0);r(K);var vr={};G(()=>{I(Dr,e(qe)),vr!==(vr=e(qe))&&(K.value=(K.__value=e(qe))??"")}),u(Le,K)}),r(b),X(b,()=>e(j),Le=>a(j,Le)),u(f,b)},Fe=f=>{var b=wt();R(b),C(b,()=>e(j),q=>a(j,q)),u(f,b)};k(J,f=>{e(H).length>0?f(se):f(Fe,!1)})}r(L);var nr=o(L,2),cr=o(t(nr),2);R(cr),r(nr),r(S),r(l),C(cr,()=>e(B),f=>a(B,f)),u(s,l)};k(lr,s=>{e(E)==="full"&&s(Br)})}var dr=o(lr,2),N=t(dr),Ar=t(N);{var Fr=s=>{dt(s,{class:"w-5 h-5 animate-spin"})},Lr=s=>{nt(s,{class:"w-5 h-5"})};k(Ar,s=>{e(Z)?s(Fr):s(Lr,!1)})}M(),r(N);var qr=o(N,2);r(dr),G(()=>{pr($e,1,`flex flex-col items-start p-3 border-2 rounded-lg transition-colors text-left
								${e(E)==="full"?"border-blue-600 bg-blue-50":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`),pr(Ye,1,`flex flex-col items-start p-3 border-2 rounded-lg transition-colors text-left
								${e(E)==="export_only"?"border-blue-600 bg-blue-50":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`),I(Sr,e(E)==="export_only"?"Environment":"Test Environment"),I(Pr,e(E)==="export_only"?"Elastic space and Git branch for export":"Development and testing configuration"),N.disabled=e(Z)||!e(U)||!e(P)||!e(W),ur(qr,"href",`/projects/${e(A)??""}`)}),C(Ue,()=>e(U),s=>a(U,s)),C(We,()=>e(re),s=>a(re,s)),X(ke,()=>e(P),s=>a(P,s)),X(we,()=>e(W),s=>a(W,s)),C(Je,()=>e(te),s=>a(te,s)),gr(Ke,()=>e(ae),s=>a(ae,s)),Q("click",$e,()=>a(E,"full")),Q("click",Ye,()=>a(E,"export_only")),gr(rr,()=>e(V),s=>a(V,s)),C(ir,()=>e(T),s=>a(T,s)),Q("click",N,yr),u(i,d)};k(xr,i=>{e(pe)?i(hr):i(kr,!1)})}r(be),G(()=>ur(_e,"href",`/projects/${e(A)??""}`)),u(ne,be),Ur(),ue()}export{Ut as component};
